<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABC ì¹œêµ¬ ë„ìš°ë¯¸ v2</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        /* ==================== CSS CUSTOM PROPERTIES (Design System) ==================== */
        :root {
            /* Colors */
            --color-bg: #FAFAF6;
            --color-surface: #FFFFFF;
            --color-surface-hover: #F7F7F3;
            --color-ink: #1A1A2E;
            --color-ink-soft: #6B6D7B;
            --color-ink-muted: #A8AABB;
            --color-border: #EEEDF2;
            --color-border-focus: #C4B5FD;
            --color-accent: #FF7E5F;
            --color-accent-light: #FFF0EB;
            --color-accent-grad: linear-gradient(135deg, #FF7E5F, #FEB47B);

            /* Step Colors */
            --color-s1: #14B8A6;
            --color-s1-bg: #F0FDFA;
            --color-s1-soft: #CCFBF1;
            --color-s2: #818CF8;
            --color-s2-bg: #F5F3FF;
            --color-s2-soft: #E0E7FF;
            --color-s3: #F59E0B;
            --color-s3-bg: #FFFBEB;
            --color-s3-soft: #FEF3C7;
            --color-s4: #EC4899;
            --color-s4-bg: #FDF2F8;
            --color-s4-soft: #FCE7F3;

            --color-success: #10B981;
            --color-success-bg: #ECFDF5;

            /* Border Radius */
            --radius-sm: 10px;
            --radius-md: 16px;
            --radius-lg: 24px;
            --radius-xl: 32px;
            --radius-full: 9999px;

            /* Shadows */
            --shadow-sm: 0 1px 3px rgba(26,26,46,0.04);
            --shadow-md: 0 4px 20px rgba(26,26,46,0.06);
            --shadow-lg: 0 12px 40px rgba(26,26,46,0.08);

            /* Transitions */
            --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);

            /* Fonts */
            --font-title: 'Jua', sans-serif;
            --font-body: 'Noto Sans KR', sans-serif;
        }

        /* ==================== GLOBAL STYLES ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background: var(--color-bg);
            color: var(--color-ink);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-title);
            font-weight: 400;
            line-height: 1.3;
        }

        button {
            font-family: var(--font-body);
            cursor: pointer;
            border: none;
            transition: var(--transition);
        }

        button:focus-visible {
            outline: 3px solid var(--color-border-focus);
            outline-offset: 2px;
        }

        input, textarea, select {
            font-family: var(--font-body);
            transition: var(--transition);
        }

        input:focus, textarea:focus, select:focus {
            outline: 2px solid var(--color-border-focus);
            outline-offset: 2px;
        }

        /* ==================== ONBOARDING SCREEN ==================== */
        #onboarding {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            text-align: center;
            background: var(--color-accent-grad);
        }

        #onboarding.hidden {
            display: none;
        }

        .onboarding-content {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            padding: 60px 40px;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            max-width: 500px;
            animation: fadeInUp 0.6s ease-out;
        }

        .onboarding-emoji {
            font-size: 120px;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        .onboarding-title {
            font-size: 36px;
            color: var(--color-ink);
            margin-bottom: 10px;
        }

        .onboarding-subtitle {
            font-size: 18px;
            color: var(--color-ink-soft);
            margin-bottom: 40px;
        }

        .onboarding-btn {
            background: var(--color-accent-grad);
            color: white;
            font-size: 20px;
            font-weight: 700;
            padding: 18px 60px;
            border-radius: var(--radius-full);
            box-shadow: var(--shadow-md);
        }

        .onboarding-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .onboarding-btn:active {
            transform: translateY(0);
        }

        /* ==================== MAIN APP CONTAINER ==================== */
        #app {
            display: none;
            opacity: 0;
            animation: fadeIn 0.5s ease-out forwards;
        }

        #app.visible {
            display: block;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ==================== HEADER ==================== */
        header {
            background: var(--color-surface);
            padding: 30px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            margin-bottom: 30px;
        }

        .header-title {
            font-size: 32px;
            color: var(--color-accent);
            text-align: center;
            margin-bottom: 20px;
        }

        .header-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--color-ink-soft);
        }

        .input-group input {
            padding: 12px 16px;
            border: 2px solid var(--color-border);
            border-radius: var(--radius-sm);
            font-size: 16px;
        }

        .input-group input:focus {
            border-color: var(--color-border-focus);
        }

        .reset-all-btn {
            background: linear-gradient(135deg, #EF4444, #DC2626);
            color: white;
            padding: 12px 24px;
            border-radius: var(--radius-full);
            font-weight: 500;
            box-shadow: var(--shadow-sm);
        }

        .reset-all-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* ==================== CIRCULAR PROGRESS STEPPER ==================== */
        .progress-stepper {
            background: var(--color-surface);
            padding: 40px 30px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            margin-bottom: 30px;
        }

        .progress-percent {
            text-align: center;
            font-size: 48px;
            font-family: var(--font-title);
            color: var(--color-accent);
            margin-bottom: 30px;
        }

        .steps-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            margin-bottom: 20px;
        }

        .step-line {
            position: absolute;
            top: 30px;
            left: 10%;
            right: 10%;
            height: 3px;
            background: var(--color-border);
            z-index: 0;
        }

        .step-line-progress {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: var(--color-accent-grad);
            transition: width 0.5s ease;
            border-radius: var(--radius-full);
        }

        .step-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            position: relative;
            z-index: 1;
        }

        .step-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--color-surface);
            border: 3px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: var(--transition);
        }

        .step-item.active .step-circle {
            border-color: var(--color-accent);
            box-shadow: 0 0 0 4px var(--color-accent-light);
            transform: scale(1.1);
        }

        .step-item.completed .step-circle {
            background: var(--color-success);
            border-color: var(--color-success);
        }

        .step-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--color-ink-soft);
            text-align: center;
        }

        .step-item.active .step-label {
            color: var(--color-accent);
            font-weight: 700;
        }

        /* ==================== CARD STYLES (Glassmorphism) ==================== */
        .card {
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
            padding: 30px;
            box-shadow: var(--shadow-md);
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.5);
        }

        .card-title {
            font-size: 24px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title-emoji {
            font-size: 32px;
        }

        /* ==================== WORRY INPUT SECTION ==================== */
        .worry-mode-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            flex: 1;
            padding: 12px 20px;
            background: var(--color-surface);
            border: 2px solid var(--color-border);
            border-radius: var(--radius-sm);
            font-weight: 500;
            color: var(--color-ink-soft);
        }

        .mode-btn.active {
            background: var(--color-accent-grad);
            border-color: var(--color-accent);
            color: white;
        }

        .worry-content {
            display: none;
        }

        .worry-content.active {
            display: block;
        }

        .worry-select-container select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--color-border);
            border-radius: var(--radius-sm);
            font-size: 16px;
            margin-bottom: 15px;
        }

        .abc-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .abc-item label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--color-ink-soft);
        }

        .abc-item textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--color-border);
            border-radius: var(--radius-sm);
            font-size: 16px;
            resize: vertical;
            min-height: 80px;
        }

        .selected-worry-display {
            background: var(--color-accent-light);
            padding: 20px;
            border-radius: var(--radius-md);
            margin-top: 20px;
        }

        .selected-worry-display h4 {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--color-accent);
        }

        .worry-abc-item {
            margin-bottom: 12px;
        }

        .worry-abc-item strong {
            color: var(--color-ink);
        }

        /* ==================== STEP 1: EMOTION SELECTION ==================== */
        .emotion-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .emotion-card {
            background: var(--color-surface);
            border: 3px solid var(--color-border);
            border-radius: var(--radius-md);
            padding: 20px 10px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .emotion-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .emotion-card.selected {
            border-color: var(--color-s1);
            background: var(--color-s1-soft);
        }

        .emotion-emoji {
            font-size: 48px;
            margin-bottom: 8px;
        }

        .emotion-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--color-ink);
        }

        .custom-emotion-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .custom-emotion-input input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--color-border);
            border-radius: var(--radius-sm);
        }

        .add-emotion-btn {
            background: var(--color-s1);
            color: white;
            padding: 12px 24px;
            border-radius: var(--radius-sm);
            font-weight: 500;
        }

        .selected-emotions-display {
            background: var(--color-s1-bg);
            padding: 20px;
            border-radius: var(--radius-md);
            margin-bottom: 15px;
        }

        .selected-emotions-display h4 {
            font-size: 16px;
            margin-bottom: 12px;
            color: var(--color-s1);
        }

        .emotion-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .emotion-tag {
            background: white;
            padding: 8px 16px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .remove-emotion-btn {
            background: var(--color-accent);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .reset-emotions-btn {
            background: var(--color-ink-muted);
            color: white;
            padding: 10px 20px;
            border-radius: var(--radius-full);
            font-size: 14px;
        }

        /* ==================== STEP 2: EMPATHY EXPRESSION ==================== */
        .empathy-form-group {
            margin-bottom: 20px;
        }

        .empathy-form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--color-ink-soft);
        }

        .empathy-form-group select,
        .empathy-form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--color-border);
            border-radius: var(--radius-sm);
            font-size: 16px;
        }

        .empathy-form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .empathy-form-group .custom-input {
            margin-top: 8px;
            min-height: 44px;
            font-size: 15px;
            color: var(--color-ink);
            background: var(--color-surface-hover);
            border: 2px dashed var(--color-border);
            transition: border-color 0.2s;
        }

        .empathy-form-group .custom-input:focus {
            border-color: var(--color-s2);
            background: var(--color-surface);
            outline: none;
        }

        .empathy-preview {
            background: var(--color-s2-bg);
            padding: 20px;
            border-radius: var(--radius-md);
            margin: 20px 0;
            border-left: 4px solid var(--color-s2);
        }

        .empathy-preview h4 {
            font-size: 16px;
            margin-bottom: 12px;
            color: var(--color-s2);
        }

        .empathy-preview-text {
            font-size: 16px;
            line-height: 1.8;
            color: var(--color-ink);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .auto-complete-btn {
            background: var(--color-s2);
            color: white;
            padding: 12px 24px;
            border-radius: var(--radius-sm);
            font-weight: 500;
        }

        .reset-btn {
            background: var(--color-ink-muted);
            color: white;
            padding: 12px 24px;
            border-radius: var(--radius-sm);
            font-weight: 500;
        }

        /* ==================== STEP 3: HELP FINDING ==================== */
        .help-section {
            background: var(--color-s3-bg);
            padding: 20px;
            border-radius: var(--radius-md);
            margin-bottom: 20px;
        }

        .help-section h4 {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--color-s3);
        }

        .checklist {
            margin-bottom: 15px;
        }

        .checklist-item {
            display: flex;
            align-items: start;
            gap: 10px;
            padding: 10px;
            margin-bottom: 8px;
            background: white;
            border-radius: var(--radius-sm);
        }

        .checklist-item input[type="checkbox"] {
            margin-top: 4px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checklist-item label {
            flex: 1;
            cursor: pointer;
            font-size: 15px;
        }

        .apply-btn {
            background: var(--color-s3);
            color: white;
            padding: 10px 20px;
            border-radius: var(--radius-sm);
            font-weight: 500;
            margin-bottom: 15px;
        }

        .help-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--color-border);
            border-radius: var(--radius-sm);
            font-size: 16px;
            min-height: 100px;
            resize: vertical;
        }

        .help-solutions-btn {
            background: var(--color-accent-grad);
            color: white;
            padding: 14px 28px;
            border-radius: var(--radius-full);
            font-weight: 700;
            box-shadow: var(--shadow-md);
            margin-top: 20px;
        }

        .help-solutions-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* ==================== STEP 4: ENCOURAGEMENT ==================== */
        .encouragement-section {
            background: var(--color-s4-bg);
            padding: 20px;
            border-radius: var(--radius-md);
            margin-bottom: 20px;
        }

        .random-message-display {
            background: white;
            padding: 30px;
            border-radius: var(--radius-md);
            text-align: center;
            margin-bottom: 20px;
            position: relative;
            border: 3px solid var(--color-s4-soft);
        }

        .random-message-text {
            font-size: 20px;
            font-weight: 500;
            color: var(--color-ink);
            margin-bottom: 10px;
        }

        .random-message-emoji {
            font-size: 48px;
        }

        .favorite-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            font-size: 24px;
            padding: 8px;
        }

        .favorite-btn.favorited {
            filter: drop-shadow(0 0 8px gold);
        }

        .draw-message-btn {
            background: var(--color-s4);
            color: white;
            padding: 12px 24px;
            border-radius: var(--radius-sm);
            font-weight: 500;
            margin-bottom: 20px;
        }

        .personal-encouragement-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--color-ink-soft);
        }

        .personal-encouragement-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--color-border);
            border-radius: var(--radius-sm);
            font-size: 16px;
            min-height: 100px;
            resize: vertical;
            margin-bottom: 20px;
        }

        .promise-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: white;
            border-radius: var(--radius-sm);
        }

        .promise-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .promise-checkbox label {
            flex: 1;
            cursor: pointer;
            font-weight: 500;
        }

        /* ==================== RESULT SCREEN ==================== */
        .result-section {
            background: var(--color-success-bg);
            padding: 40px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
        }

        .result-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .result-title {
            font-size: 36px;
            color: var(--color-success);
            margin-bottom: 10px;
        }

        .result-subtitle {
            font-size: 18px;
            color: var(--color-ink-soft);
        }

        .result-item {
            background: white;
            padding: 30px;
            border-radius: var(--radius-md);
            margin-bottom: 20px;
            border-left: 6px solid;
        }

        .result-item.step1 { border-left-color: var(--color-s1); }
        .result-item.step2 { border-left-color: var(--color-s2); }
        .result-item.step3 { border-left-color: var(--color-s3); }
        .result-item.step4 { border-left-color: var(--color-s4); }

        .result-item-title {
            font-size: 22px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .result-item-content {
            font-size: 16px;
            line-height: 1.8;
            color: var(--color-ink);
        }

        .result-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .download-png-btn {
            background: linear-gradient(135deg, #06B6D4, #0891B2);
            color: white;
            padding: 14px 28px;
            border-radius: var(--radius-full);
            font-weight: 700;
            box-shadow: var(--shadow-md);
        }

        .download-pdf-btn {
            background: linear-gradient(135deg, #8B5CF6, #7C3AED);
            color: white;
            padding: 14px 28px;
            border-radius: var(--radius-full);
            font-weight: 700;
            box-shadow: var(--shadow-md);
        }

        .print-btn {
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
            padding: 14px 28px;
            border-radius: var(--radius-full);
            font-weight: 700;
            box-shadow: var(--shadow-md);
        }

        .new-consultation-btn {
            background: var(--color-accent-grad);
            color: white;
            padding: 14px 28px;
            border-radius: var(--radius-full);
            font-weight: 700;
            box-shadow: var(--shadow-md);
        }

        /* ==================== NAVIGATION BUTTONS ==================== */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 15px;
        }

        .nav-btn {
            padding: 14px 32px;
            border-radius: var(--radius-full);
            font-weight: 700;
            font-size: 16px;
            box-shadow: var(--shadow-sm);
            min-width: 140px;
        }

        .prev-btn {
            background: var(--color-surface);
            color: var(--color-ink-soft);
            border: 2px solid var(--color-border);
        }

        .next-btn {
            background: var(--color-accent-grad);
            color: white;
        }

        .next-btn:hover, .download-png-btn:hover, .download-pdf-btn:hover,
        .print-btn:hover, .new-consultation-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .next-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* ==================== MODAL ==================== */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(26,26,46,0.7);
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: var(--radius-xl);
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s ease-out;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 28px;
            color: var(--color-accent);
        }

        .close-modal {
            background: transparent;
            font-size: 32px;
            color: var(--color-ink-soft);
            padding: 0;
            width: 40px;
            height: 40px;
        }

        .close-modal:hover {
            color: var(--color-accent);
        }

        .modal-body {
            font-size: 16px;
            line-height: 1.8;
            color: var(--color-ink);
        }

        .modal-body h3 {
            font-size: 20px;
            margin-top: 20px;
            margin-bottom: 10px;
            color: var(--color-accent);
        }

        .modal-body ul {
            list-style: none;
            padding: 0;
        }

        .modal-body li {
            padding: 8px 0;
            padding-left: 24px;
            position: relative;
        }

        .modal-body li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: var(--color-success);
            font-weight: 700;
        }

        /* ==================== NOTIFICATION TOAST ==================== */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 16px 24px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 2000;
            animation: slideInRight 0.3s ease-out;
        }

        .toast.show {
            display: flex;
        }

        .toast.success {
            border-left: 4px solid var(--color-success);
        }

        .toast.error {
            border-left: 4px solid #EF4444;
        }

        .toast-icon {
            font-size: 24px;
        }

        .toast-message {
            font-weight: 500;
            color: var(--color-ink);
        }

        /* ==================== ANIMATIONS ==================== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .fade-enter {
            animation: fadeIn 0.5s ease-out;
        }

        /* ==================== UTILITY CLASSES ==================== */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        /* ==================== PRINT STYLES ==================== */
        @media print {
            body {
                background: white;
            }

            #onboarding,
            .progress-stepper,
            .nav-buttons,
            .result-actions,
            .toast,
            .modal {
                display: none !important;
            }

            .card, .result-item {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid var(--color-border);
            }
        }

        /* ==================== RESPONSIVE DESIGN ==================== */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header-inputs {
                grid-template-columns: 1fr;
            }

            .onboarding-content {
                padding: 40px 30px;
            }

            .onboarding-emoji {
                font-size: 80px;
            }

            .onboarding-title {
                font-size: 28px;
            }

            .onboarding-subtitle {
                font-size: 16px;
            }

            .progress-percent {
                font-size: 36px;
            }

            .step-circle {
                width: 50px;
                height: 50px;
                font-size: 24px;
            }

            .step-label {
                font-size: 12px;
            }

            .emotion-grid {
                grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            }

            .nav-buttons {
                flex-direction: column;
            }

            .nav-btn {
                width: 100%;
            }

            .result-actions {
                flex-direction: column;
            }

            .result-actions button {
                width: 100%;
            }

            .modal-content {
                margin: 20px;
                padding: 30px 20px;
            }
        }

        @media (max-width: 480px) {
            .card-title {
                font-size: 20px;
            }

            .result-title {
                font-size: 28px;
            }

            .steps-container {
                flex-wrap: wrap;
            }

            .step-item {
                flex-basis: 50%;
                margin-bottom: 20px;
            }

            .step-line {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- ==================== ONBOARDING SCREEN ==================== -->
    <div id="onboarding">
        <div class="onboarding-content">
            <div class="onboarding-emoji">ğŸ¤—</div>
            <h1 class="onboarding-title">ABC ì¹œêµ¬ ë„ìš°ë¯¸</h1>
            <p class="onboarding-subtitle">ì¹œêµ¬ì˜ ê³ ë¯¼ì„ í•¨ê»˜ ë‚˜ëˆ„ê³ <br>ë”°ëœ»í•œ ìœ„ë¡œë¥¼ ì „í•´ë³´ì„¸ìš”</p>
            <button class="onboarding-btn" onclick="ABCHelper.startApp()">ì‹œì‘í•˜ê¸°</button>
        </div>
    </div>

    <!-- ==================== MAIN APP ==================== -->
    <div id="app">
        <div class="container">
            <!-- ==================== HEADER ==================== -->
            <header>
                <h1 class="header-title">ABC ì¹œêµ¬ ë„ìš°ë¯¸ v2</h1>
                <div class="header-inputs">
                    <div class="input-group">
                        <label for="counselor-name">ìƒë‹´ì ì´ë¦„</label>
                        <input type="text" id="counselor-name" placeholder="ë‚´ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="input-group">
                        <label for="client-name">ìƒë‹´ë°›ëŠ” ì¹œêµ¬ ì´ë¦„</label>
                        <input type="text" id="client-name" placeholder="ì¹œêµ¬ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                </div>
                <div class="text-center">
                    <button class="reset-all-btn" onclick="ABCHelper.resetAll()">ì „ì²´ ì´ˆê¸°í™”</button>
                </div>
            </header>

            <!-- ==================== PROGRESS STEPPER ==================== -->
            <div class="progress-stepper">
                <div class="progress-percent">
                    <span id="progress-percent">0</span>%
                </div>
                <div class="steps-container">
                    <div class="step-line">
                        <div class="step-line-progress" id="step-line-progress"></div>
                    </div>
                    <div class="step-item" data-step="1" onclick="ABCHelper.goToStep(1)">
                        <div class="step-circle">ğŸ’™</div>
                        <div class="step-label">ë§ˆìŒ ê³µê°í•˜ê¸°</div>
                    </div>
                    <div class="step-item" data-step="2" onclick="ABCHelper.goToStep(2)">
                        <div class="step-circle">ğŸ’¬</div>
                        <div class="step-label">ê³µê° í‘œí˜„í•˜ê¸°</div>
                    </div>
                    <div class="step-item" data-step="3" onclick="ABCHelper.goToStep(3)">
                        <div class="step-circle">ğŸ¤</div>
                        <div class="step-label">ë„ì›€ ì°¾ê¸°</div>
                    </div>
                    <div class="step-item" data-step="4" onclick="ABCHelper.goToStep(4)">
                        <div class="step-circle">âœ¨</div>
                        <div class="step-label">ê²©ë ¤í•˜ê¸°</div>
                    </div>
                </div>
            </div>

            <!-- ==================== WORRY INPUT SECTION ==================== -->
            <div class="card" id="worry-section">
                <h2 class="card-title">
                    <span class="card-title-emoji">ğŸ“</span>
                    ì¹œêµ¬ì˜ ê³ ë¯¼
                </h2>

                <div class="worry-mode-toggle">
                    <button class="mode-btn active" data-mode="example" onclick="ABCHelper.switchWorryMode('example')">
                        ê³ ë¯¼ ì‚¬ë¡€ ì„ íƒ
                    </button>
                    <button class="mode-btn" data-mode="direct" onclick="ABCHelper.switchWorryMode('direct')">
                        ì§ì ‘ ì…ë ¥í•˜ê¸°
                    </button>
                </div>

                <div class="worry-content active" id="worry-example-mode">
                    <div class="worry-select-container">
                        <select id="worry-case-select" onchange="ABCHelper.selectWorryCase()">
                            <option value="">-- ê³ ë¯¼ ì‚¬ë¡€ë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>
                            <optgroup label="í•™êµìƒí™œ">
                                <option value="school-1">ë°œí‘œê°€ ë‘ë ¤ì›Œìš”</option>
                                <option value="school-2">ì„±ì ì´ ë–¨ì–´ì¡Œì–´ìš”</option>
                                <option value="school-3">ì„ ìƒë‹˜ê»˜ í˜¼ë‚¬ì–´ìš”</option>
                            </optgroup>
                            <optgroup label="ì¹œêµ¬ê´€ê³„">
                                <option value="friend-1">ì¹œêµ¬ê°€ ë†€ë ¤ìš”</option>
                                <option value="friend-2">ì¹œêµ¬ì™€ ì‹¸ì› ì–´ìš”</option>
                                <option value="friend-3">ì¹œêµ¬ê°€ ë¹„ë°€ì„ ë§í–ˆì–´ìš”</option>
                            </optgroup>
                            <optgroup label="ê°€ì¡±ê´€ê³„">
                                <option value="family-1">ë¶€ëª¨ë‹˜ì´ ì‹¸ìš°ì…¨ì–´ìš”</option>
                                <option value="family-2">ë™ìƒ ë•Œë¬¸ì— ì†ìƒí•´ìš”</option>
                                <option value="family-3">ë¶€ëª¨ë‹˜ì´ ë°”ì˜ì…”ì„œ ì™¸ë¡œì›Œìš”</option>
                            </optgroup>
                            <optgroup label="ê°ì •ê³¼ìì‹ ê°">
                                <option value="emotion-1">ìì‹ ê°ì´ ì—†ì–´ìš”</option>
                                <option value="emotion-2">ê±±ì •ì´ ë§ì•„ìš”</option>
                                <option value="emotion-3">í™”ê°€ ìì£¼ ë‚˜ìš”</option>
                            </optgroup>
                        </select>
                    </div>
                </div>

                <div class="worry-content" id="worry-direct-mode">
                    <div class="abc-grid">
                        <div class="abc-item">
                            <label>A (ì‚¬ì‹¤): ë¬´ìŠ¨ ì¼ì´ ìˆì—ˆë‚˜ìš”?</label>
                            <textarea id="direct-a" placeholder="ì˜ˆ: ì¹œêµ¬ê°€ ë‚˜ë¥¼ ë†€ë ¸ì–´ìš”"></textarea>
                        </div>
                        <div class="abc-item">
                            <label>B (ìƒê°): ì–´ë–¤ ìƒê°ì´ ë“¤ì—ˆë‚˜ìš”?</label>
                            <textarea id="direct-b" placeholder="ì˜ˆ: ë‚˜ë¥¼ ì‹«ì–´í•˜ë‚˜ë´"></textarea>
                        </div>
                        <div class="abc-item">
                            <label>C (ê²°ê³¼): ì–´ë–¤ ê¸°ë¶„ì´ë‚˜ í–‰ë™ì´ ë‚˜íƒ€ë‚¬ë‚˜ìš”?</label>
                            <textarea id="direct-c" placeholder="ì˜ˆ: ìŠ¬í”„ê³  í™”ê°€ ë‚¬ì–´ìš”"></textarea>
                        </div>
                    </div>
                    <div class="text-center mt-20">
                        <button class="auto-complete-btn" onclick="ABCHelper.applyDirectInput()">ì ìš©í•˜ê¸°</button>
                    </div>
                </div>

                <div class="selected-worry-display hidden" id="selected-worry-display">
                    <h4>ì„ íƒëœ ê³ ë¯¼</h4>
                    <div class="worry-abc-item">
                        <strong>A (ì‚¬ì‹¤):</strong> <span id="display-a"></span>
                    </div>
                    <div class="worry-abc-item">
                        <strong>B (ìƒê°):</strong> <span id="display-b"></span>
                    </div>
                    <div class="worry-abc-item">
                        <strong>C (ê²°ê³¼):</strong> <span id="display-c"></span>
                    </div>
                    <div style="text-align: center; margin-top: 24px;">
                        <button class="next-btn" onclick="ABCHelper.goToStep(1)" style="font-size: 1.1rem; padding: 14px 40px;">1ë‹¨ê³„ë¡œ ì‹œì‘í•˜ê¸° â†’</button>
                    </div>
                </div>
            </div>

            <!-- ==================== STEP 1: ë§ˆìŒ ê³µê°í•˜ê¸° ==================== -->
            <div class="card hidden" id="step-1">
                <h2 class="card-title">
                    <span class="card-title-emoji">ğŸ’™</span>
                    Step 1: ë§ˆìŒ ê³µê°í•˜ê¸°
                </h2>

                <p style="margin-bottom: 20px; color: var(--color-ink-soft);">
                    ì¹œêµ¬ê°€ ëŠë‚€ ê°ì •ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.
                </p>

                <div class="emotion-grid">
                    <div class="emotion-card" data-emotion="ìŠ¬í””" onclick="ABCHelper.toggleEmotion('ìŠ¬í””', 'ğŸ˜¢')">
                        <div class="emotion-emoji">ğŸ˜¢</div>
                        <div class="emotion-label">ìŠ¬í””</div>
                    </div>
                    <div class="emotion-card" data-emotion="í™”ë‚¨" onclick="ABCHelper.toggleEmotion('í™”ë‚¨', 'ğŸ˜ ')">
                        <div class="emotion-emoji">ğŸ˜ </div>
                        <div class="emotion-label">í™”ë‚¨</div>
                    </div>
                    <div class="emotion-card" data-emotion="ê±±ì •" onclick="ABCHelper.toggleEmotion('ê±±ì •', 'ğŸ˜Ÿ')">
                        <div class="emotion-emoji">ğŸ˜Ÿ</div>
                        <div class="emotion-label">ê±±ì •</div>
                    </div>
                    <div class="emotion-card" data-emotion="ì‹¤ë§" onclick="ABCHelper.toggleEmotion('ì‹¤ë§', 'ğŸ˜')">
                        <div class="emotion-emoji">ğŸ˜</div>
                        <div class="emotion-label">ì‹¤ë§</div>
                    </div>
                    <div class="emotion-card" data-emotion="ë‘ë ¤ì›€" onclick="ABCHelper.toggleEmotion('ë‘ë ¤ì›€', 'ğŸ˜¨')">
                        <div class="emotion-emoji">ğŸ˜¨</div>
                        <div class="emotion-label">ë‘ë ¤ì›€</div>
                    </div>
                    <div class="emotion-card" data-emotion="ë¶€ë„ëŸ¬ì›€" onclick="ABCHelper.toggleEmotion('ë¶€ë„ëŸ¬ì›€', 'ğŸ˜³')">
                        <div class="emotion-emoji">ğŸ˜³</div>
                        <div class="emotion-label">ë¶€ë„ëŸ¬ì›€</div>
                    </div>
                    <div class="emotion-card" data-emotion="ì„œê¸€í””" onclick="ABCHelper.toggleEmotion('ì„œê¸€í””', 'ğŸ˜”')">
                        <div class="emotion-emoji">ğŸ˜”</div>
                        <div class="emotion-label">ì„œê¸€í””</div>
                    </div>
                    <div class="emotion-card" data-emotion="ë‹µë‹µí•¨" onclick="ABCHelper.toggleEmotion('ë‹µë‹µí•¨', 'ğŸ˜¤')">
                        <div class="emotion-emoji">ğŸ˜¤</div>
                        <div class="emotion-label">ë‹µë‹µí•¨</div>
                    </div>
                </div>

                <div class="custom-emotion-input">
                    <input type="text" id="custom-emotion-input" placeholder="ë‹¤ë¥¸ ê°ì •ì„ ì¶”ê°€í•˜ì„¸ìš”">
                    <button class="add-emotion-btn" onclick="ABCHelper.addCustomEmotion()">ì¶”ê°€</button>
                </div>

                <div class="selected-emotions-display hidden" id="selected-emotions-display">
                    <h4>ì„ íƒëœ ê°ì •</h4>
                    <div class="emotion-tags" id="selected-emotions-list"></div>
                </div>

                <div class="text-center mt-20">
                    <button class="reset-emotions-btn" onclick="ABCHelper.resetEmotions()">ê°ì • ì´ˆê¸°í™”</button>
                </div>

                <div class="nav-buttons">
                    <button class="nav-btn prev-btn" onclick="ABCHelper.goToWorrySection()">ì´ì „</button>
                    <button class="nav-btn next-btn" onclick="ABCHelper.nextStep()" id="step1-next">ë‹¤ìŒ</button>
                </div>
            </div>

            <!-- ==================== STEP 2: ê³µê° í‘œí˜„í•˜ê¸° ==================== -->
            <div class="card hidden" id="step-2">
                <h2 class="card-title">
                    <span class="card-title-emoji">ğŸ’¬</span>
                    Step 2: ê³µê° í‘œí˜„í•˜ê¸°
                </h2>

                <div class="empathy-form-group">
                    <label>í˜„ì¬ ìƒí™© (A - ì‚¬ì‹¤)</label>
                    <p id="empathy-situation" style="padding: 12px; background: var(--color-s2-bg); border-radius: var(--radius-sm); margin-bottom: 15px;"></p>
                </div>

                <div class="empathy-form-group">
                    <label>B (ìƒê°)</label>
                    <select id="empathy-belief">
                        <option value="">-- ì˜ˆì‹œì—ì„œ ì„ íƒí•˜ì„¸ìš” --</option>
                    </select>
                    <textarea id="empathy-belief-custom" class="custom-input" placeholder="ë˜ëŠ” ì§ì ‘ ì…ë ¥í•´ ë³´ì„¸ìš” (ì˜ˆ: ë‚˜ë§Œ í˜¼ìì¸ ê²ƒ ê°™ì•„)" rows="2"></textarea>
                </div>

                <div class="empathy-form-group">
                    <label>C (ëŠë‚Œ/ê²°ê³¼)</label>
                    <select id="empathy-feeling">
                        <option value="">-- ì˜ˆì‹œì—ì„œ ì„ íƒí•˜ì„¸ìš” --</option>
                    </select>
                    <textarea id="empathy-feeling-custom" class="custom-input" placeholder="ë˜ëŠ” ì§ì ‘ ì…ë ¥í•´ ë³´ì„¸ìš” (ì˜ˆ: ì†ìƒí•˜ê³  ì™¸ë¡œì› ì–´)" rows="2"></textarea>
                </div>

                <div class="empathy-form-group">
                    <label>ë§ˆë¬´ë¦¬ ë§</label>
                    <select id="empathy-closing">
                        <option value="">-- ì˜ˆì‹œì—ì„œ ì„ íƒí•˜ì„¸ìš” --</option>
                    </select>
                    <textarea id="empathy-closing-custom" class="custom-input" placeholder="ë˜ëŠ” ì§ì ‘ ì…ë ¥í•´ ë³´ì„¸ìš” (ì˜ˆ: ë‚´ê°€ ì˜†ì— ìˆì–´ ì¤„ê²Œ)" rows="2"></textarea>
                </div>

                <div class="empathy-preview">
                    <h4>ê³µê° í‘œí˜„ ë¯¸ë¦¬ë³´ê¸°</h4>
                    <div class="empathy-preview-text" id="empathy-preview"></div>
                </div>

                <div class="empathy-form-group">
                    <label>ê³µê° í‘œí˜„ ìˆ˜ì •í•˜ê¸°</label>
                    <textarea id="empathy-manual" placeholder="ìœ„ì˜ ê³µê° í‘œí˜„ì„ ì§ì ‘ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"></textarea>
                </div>

                <div class="btn-group">
                    <button class="auto-complete-btn" onclick="ABCHelper.autoCompleteEmpathy()">ì¶”ì²œ ê³µê° í‘œí˜„ ìë™ ìƒì„±í•˜ê¸°</button>
                    <button class="reset-btn" onclick="ABCHelper.resetEmpathy()">ê³µê° í‘œí˜„ ì´ˆê¸°í™”</button>
                </div>

                <div class="nav-buttons">
                    <button class="nav-btn prev-btn" onclick="ABCHelper.prevStep()">ì´ì „</button>
                    <button class="nav-btn next-btn" onclick="ABCHelper.nextStep()" id="step2-next">ë‹¤ìŒ</button>
                </div>
            </div>

            <!-- ==================== STEP 3: ë„ì›€ ì°¾ê¸° ==================== -->
            <div class="card hidden" id="step-3">
                <h2 class="card-title">
                    <span class="card-title-emoji">ğŸ¤</span>
                    Step 3: ë„ì›€ ì°¾ê¸°
                </h2>

                <div class="help-section">
                    <h4>1. ë” ë„ì›€ì´ ë˜ëŠ” ìƒê° ë§Œë“¤ê¸°</h4>
                    <div class="checklist" id="thinking-checklist"></div>
                    <button class="apply-btn" onclick="ABCHelper.applyThinkingChecklist()">ì„ íƒí•œ ë‚´ìš© ì ìš©í•˜ê¸°</button>
                    <textarea class="help-textarea" id="helpful-thinking" placeholder="ë„ì›€ì´ ë˜ëŠ” ìƒê°ì„ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                </div>

                <div class="help-section">
                    <h4>2. êµ¬ì²´ì ì¸ ë„ì›€ ë°©ë²•</h4>
                    <div class="checklist" id="help-checklist"></div>
                    <button class="apply-btn" onclick="ABCHelper.applyHelpChecklist()">ì„ íƒí•œ ë‚´ìš© ì ìš©í•˜ê¸°</button>
                    <textarea class="help-textarea" id="concrete-help" placeholder="êµ¬ì²´ì ì¸ ë„ì›€ ë°©ë²•ì„ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                </div>

                <div class="text-center">
                    <button class="help-solutions-btn" onclick="ABCHelper.showHelpModal()">ë„ì›€ ë°©ë²• ëª¨ìŒì§‘ ë³´ê¸°</button>
                </div>

                <div class="nav-buttons">
                    <button class="nav-btn prev-btn" onclick="ABCHelper.prevStep()">ì´ì „</button>
                    <button class="nav-btn next-btn" onclick="ABCHelper.nextStep()" id="step3-next">ë‹¤ìŒ</button>
                </div>
            </div>

            <!-- ==================== STEP 4: ê²©ë ¤í•˜ê¸° ==================== -->
            <div class="card hidden" id="step-4">
                <h2 class="card-title">
                    <span class="card-title-emoji">âœ¨</span>
                    Step 4: ê²©ë ¤í•˜ê¸°
                </h2>

                <div class="encouragement-section">
                    <h4>ëœë¤ ê²©ë ¤ ë©”ì‹œì§€</h4>
                    <div class="random-message-display" id="random-message-display">
                        <button class="favorite-btn" id="favorite-btn" onclick="ABCHelper.toggleFavorite()">â­</button>
                        <div class="random-message-text" id="random-message-text">ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ê²©ë ¤ ë©”ì‹œì§€ë¥¼ ë½‘ì•„ë³´ì„¸ìš”!</div>
                        <div class="random-message-emoji">ğŸ</div>
                    </div>
                    <button class="draw-message-btn" onclick="ABCHelper.drawRandomMessage()">ëœë¤ ë©”ì‹œì§€ ë½‘ê¸°</button>
                </div>

                <div class="personal-encouragement-group">
                    <label>ë‚˜ë§Œì˜ ê²©ë ¤ ë©”ì‹œì§€</label>
                    <textarea id="personal-encouragement" placeholder="ì¹œêµ¬ì—ê²Œ ì „í•˜ê³  ì‹¶ì€ ë”°ëœ»í•œ ë§ì„ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                </div>

                <div class="promise-checkbox">
                    <input type="checkbox" id="two-week-promise">
                    <label for="two-week-promise">2ì£¼ í›„ì— ë‹¤ì‹œ ë§Œë‚˜ ì´ì•¼ê¸°í•˜ê¸°ë¡œ ì•½ì†í–ˆì–´ìš”</label>
                </div>

                <div class="nav-buttons">
                    <button class="nav-btn prev-btn" onclick="ABCHelper.prevStep()">ì´ì „</button>
                    <button class="nav-btn next-btn" onclick="ABCHelper.showResult()">ìƒë‹´ ì™„ë£Œí•˜ê¸°</button>
                </div>
            </div>

            <!-- ==================== RESULT SECTION ==================== -->
            <div class="card hidden" id="result-section">
                <div class="result-section">
                    <div class="result-header">
                        <h2 class="result-title">ğŸ‰ ìƒë‹´ ê²°ê³¼</h2>
                        <p class="result-subtitle">ë”°ëœ»í•œ ë§ˆìŒìœ¼ë¡œ ì™„ì„±í•œ ì¹œêµ¬ ìƒë‹´ì…ë‹ˆë‹¤</p>
                    </div>

                    <div id="result-content"></div>

                    <div class="result-actions">
                        <button class="download-png-btn" onclick="ABCHelper.downloadPNG()">ì´ë¯¸ì§€ë¡œ ì €ì¥ (PNG)</button>
                        <button class="download-pdf-btn" onclick="ABCHelper.downloadPDF()">PDFë¡œ ì €ì¥</button>
                        <button class="print-btn" onclick="window.print()">ì¸ì‡„í•˜ê¸°</button>
                        <button class="new-consultation-btn" onclick="ABCHelper.newConsultation()">ìƒˆ ìƒë‹´ ì‹œì‘í•˜ê¸°</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== HELP MODAL ==================== -->
    <div class="modal" id="help-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ë„ì›€ ë°©ë²• ëª¨ìŒì§‘</h2>
                <button class="close-modal" onclick="ABCHelper.closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <h3>í•™êµìƒí™œ ë„ì›€ ë°©ë²•</h3>
                <ul>
                    <li>ì„ ìƒë‹˜ê»˜ ë„ì›€ ìš”ì²­í•˜ê¸°</li>
                    <li>ë°©ê³¼í›„ ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ê³µë¶€í•˜ê¸°</li>
                    <li>ì‘ì€ ëª©í‘œë¶€í„° ì°¨ê·¼ì°¨ê·¼ ë‹¬ì„±í•˜ê¸°</li>
                    <li>ë°œí‘œ ì—°ìŠµì„ ë¯¸ë¦¬ í•´ë³´ê¸°</li>
                </ul>

                <h3>ì¹œêµ¬ê´€ê³„ ë„ì›€ ë°©ë²•</h3>
                <ul>
                    <li>ì¹œêµ¬ì—ê²Œ ì†”ì§í•˜ê²Œ ë‚´ ë§ˆìŒ ì „ë‹¬í•˜ê¸°</li>
                    <li>í•¨ê»˜ ì¢‹ì•„í•˜ëŠ” í™œë™ ì°¾ì•„ë³´ê¸°</li>
                    <li>ì„œë¡œì˜ ì…ì¥ì—ì„œ ìƒê°í•´ë³´ê¸°</li>
                    <li>ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì–´ë¥¸ì—ê²Œ ë„ì›€ ìš”ì²­í•˜ê¸°</li>
                </ul>

                <h3>ê°€ì¡±ê´€ê³„ ë„ì›€ ë°©ë²•</h3>
                <ul>
                    <li>ë¶€ëª¨ë‹˜ê»˜ ë‚´ ë§ˆìŒ í¸ì§€ë¡œ ì „í•˜ê¸°</li>
                    <li>ê°€ì¡±ê³¼ í•¨ê»˜í•˜ëŠ” ì‹œê°„ ë§Œë“¤ê¸°</li>
                    <li>ë™ìƒê³¼ í•¨ê»˜ í•  ìˆ˜ ìˆëŠ” ë†€ì´ ì°¾ê¸°</li>
                    <li>í•™êµ ìƒë‹´ ì„ ìƒë‹˜ê³¼ ì´ì•¼ê¸°í•˜ê¸°</li>
                </ul>

                <h3>ê°ì •ê³¼ ìì‹ ê° ë„ì›€ ë°©ë²•</h3>
                <ul>
                    <li>ë‚´ê°€ ì˜í•˜ëŠ” ê²ƒ ëª©ë¡ ë§Œë“¤ì–´ë³´ê¸°</li>
                    <li>ê¸ì •ì ì¸ ë§ë¡œ ë‚˜ë¥¼ ê²©ë ¤í•˜ê¸°</li>
                    <li>ê±±ì • ì¼ê¸° ì“°ê¸°</li>
                    <li>ì‹¬í˜¸í¡í•˜ë©° ë§ˆìŒ ê°€ë¼ì•‰íˆê¸°</li>
                    <li>ì¢‹ì•„í•˜ëŠ” í™œë™ìœ¼ë¡œ ê¸°ë¶„ ì „í™˜í•˜ê¸°</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- ==================== NOTIFICATION TOAST ==================== -->
    <div class="toast" id="toast">
        <span class="toast-icon" id="toast-icon"></span>
        <span class="toast-message" id="toast-message"></span>
    </div>

    <!-- ==================== EXTERNAL SCRIPT ==================== -->
    <script src="js/silent-spell-helper.js"></script>

    <!-- ==================== MAIN APPLICATION SCRIPT ==================== -->
    <script>
        const ABCHelper = {
            // ==================== STATE ====================
            state: {
                currentStep: 0,
                worryMode: 'example',
                selectedWorry: null,
                selectedEmotions: [],
                empathy: {
                    situation: '',
                    belief: '',
                    feeling: '',
                    closing: '',
                    manual: ''
                },
                help: {
                    thinking: '',
                    concrete: ''
                },
                encouragement: {
                    randomMessage: '',
                    personalMessage: '',
                    twoWeekPromise: false,
                    favorited: false
                }
            },

            // ==================== DATA ====================
            emotions: [
                {name: 'ìŠ¬í””', emoji: 'ğŸ˜¢'},
                {name: 'í™”ë‚¨', emoji: 'ğŸ˜ '},
                {name: 'ê±±ì •', emoji: 'ğŸ˜Ÿ'},
                {name: 'ì‹¤ë§', emoji: 'ğŸ˜'},
                {name: 'ë‘ë ¤ì›€', emoji: 'ğŸ˜¨'},
                {name: 'ë¶€ë„ëŸ¬ì›€', emoji: 'ğŸ˜³'},
                {name: 'ì„œê¸€í””', emoji: 'ğŸ˜”'},
                {name: 'ë‹µë‹µí•¨', emoji: 'ğŸ˜¤'}
            ],

            thoughts: [
                "ë‚˜ë¥¼ ì‹«ì–´í•˜ë‚˜ë´",
                "ë‚´ê°€ ì˜ëª»í–ˆë‚˜ë´",
                "ë‚˜ëŠ” ëª»í•˜ëŠ” ê²ƒ ê°™ì•„",
                "ë‹¤ë“¤ ë‚˜ë¥¼ ì´ìƒí•˜ê²Œ ë³¼ ê±°ì•¼",
                "ë‚˜ë§Œ í˜ë“  ê²ƒ ê°™ì•„",
                "ì•„ë¬´ë„ ë‚  ì´í•´ ëª»í•´",
                "ë‚˜ëŠ” ì•ˆ ë  ê±°ì•¼",
                "ì¹œêµ¬ë“¤ì´ ë‚  ë†€ë¦´ ê±°ì•¼"
            ],

            feelings: [
                "ìŠ¬í”„ê³  ìš°ìš¸í•´ì¡Œì–´ìš”",
                "í™”ê°€ ë‚˜ê³  ì§œì¦ì´ ë‚¬ì–´ìš”",
                "ê±±ì •ë˜ê³  ë¶ˆì•ˆí–ˆì–´ìš”",
                "ì°½í”¼í•˜ê³  ë¶€ë„ëŸ¬ì› ì–´ìš”",
                "ë¬´ì„­ê³  ë‘ë ¤ì› ì–´ìš”",
                "ë‹µë‹µí•˜ê³  ì†ìƒí–ˆì–´ìš”",
                "ì™¸ë¡­ê³  ì“¸ì“¸í–ˆì–´ìš”",
                "ì‹¤ë§í•˜ê³  ì¢Œì ˆí–ˆì–´ìš”"
            ],

            closings: [
                "ê·¸ë˜ì„œ ë§ì´ í˜ë“¤ì—ˆê² êµ¬ë‚˜",
                "ë„¤ ë§ˆìŒì´ ì •ë§ ì•„íŒ ì„ ê²ƒ ê°™ì•„",
                "ê·¸ëŸ° ì¼ì´ ìˆì—ˆë‹¤ë©´ ì •ë§ ì†ìƒí–ˆê² ë‹¤",
                "ê·¸ëŸ´ ìˆ˜ ìˆì–´, ì¶©ë¶„íˆ ê·¸ëŸ´ ìˆ˜ ìˆì–´",
                "ë„ˆì˜ ë§ˆìŒì„ ì´í•´í•´"
            ],

            encouragementMessages: [
                "ë„Œ ì •ë§ ì†Œì¤‘í•œ ì¹œêµ¬ì•¼! ğŸ’–",
                "í˜ë“  ìˆœê°„ë„ ë„ˆë¼ë©´ ì˜ ì´ê²¨ë‚¼ ìˆ˜ ìˆì–´! ğŸ’ª",
                "ì–¸ì œë‚˜ ë„¤ í¸ì—ì„œ ì‘ì›í• ê²Œ! ğŸŒŸ",
                "ë„ˆì˜ ìš©ê¸°ì— ë°•ìˆ˜ë¥¼ ë³´ë‚¼ê²Œ! ğŸ‘",
                "í•¨ê»˜ë¼ë©´ ë¬´ì—‡ì´ë“  í•  ìˆ˜ ìˆì–´! ğŸ¤"
            ],

            worryCases: {
                'school-1': {
                    title: 'ë°œí‘œê°€ ë‘ë ¤ì›Œìš”',
                    A: 'ë‚´ì¼ ë°œí‘œê°€ ìˆëŠ”ë° ì¹œêµ¬ë“¤ ì•ì—ì„œ ë§í•˜ëŠ” ê²Œ ë„ˆë¬´ ë–¨ë ¤ìš”',
                    B: 'ë‹¤ë“¤ ë‚˜ë¥¼ ì´ìƒí•˜ê²Œ ë³¼ ê±°ì•¼',
                    C: 'ë¬´ì„­ê³  ë‘ë ¤ì›Œìš”',
                    category: 'school',
                    emotions: ['ë‘ë ¤ì›€', 'ê±±ì •']
                },
                'school-2': {
                    title: 'ì„±ì ì´ ë–¨ì–´ì¡Œì–´ìš”',
                    A: 'ì´ë²ˆ ì‹œí—˜ ì„±ì ì´ ë§ì´ ë–¨ì–´ì¡Œì–´ìš”',
                    B: 'ë‚˜ëŠ” ëª»í•˜ëŠ” ê²ƒ ê°™ì•„',
                    C: 'ì‹¤ë§í•˜ê³  ì¢Œì ˆí–ˆì–´ìš”',
                    category: 'school',
                    emotions: ['ì‹¤ë§', 'ë‹µë‹µí•¨']
                },
                'school-3': {
                    title: 'ì„ ìƒë‹˜ê»˜ í˜¼ë‚¬ì–´ìš”',
                    A: 'ìˆ™ì œë¥¼ ì•ˆ í•´ì„œ ì„ ìƒë‹˜ê»˜ í˜¼ë‚¬ì–´ìš”',
                    B: 'ë‚´ê°€ ì˜ëª»í–ˆë‚˜ë´',
                    C: 'ì°½í”¼í•˜ê³  ë¶€ë„ëŸ¬ì› ì–´ìš”',
                    category: 'school',
                    emotions: ['ë¶€ë„ëŸ¬ì›€', 'ìŠ¬í””']
                },
                'friend-1': {
                    title: 'ì¹œêµ¬ê°€ ë†€ë ¤ìš”',
                    A: 'ì¹œêµ¬ê°€ ë‚´ ì™¸ëª¨ë¥¼ ë†€ë ¸ì–´ìš”',
                    B: 'ë‚˜ë¥¼ ì‹«ì–´í•˜ë‚˜ë´',
                    C: 'ìŠ¬í”„ê³  ìš°ìš¸í•´ì¡Œì–´ìš”',
                    category: 'friend',
                    emotions: ['ìŠ¬í””', 'í™”ë‚¨']
                },
                'friend-2': {
                    title: 'ì¹œêµ¬ì™€ ì‹¸ì› ì–´ìš”',
                    A: 'ì¹œí•œ ì¹œêµ¬ì™€ ì‚¬ì†Œí•œ ì¼ë¡œ í¬ê²Œ ì‹¸ì› ì–´ìš”',
                    B: 'ì´ì œ ìš°ë¦¬ ì‚¬ì´ê°€ ëë‚œ ê²ƒ ê°™ì•„',
                    C: 'í™”ê°€ ë‚˜ê³  ì§œì¦ì´ ë‚¬ì–´ìš”',
                    category: 'friend',
                    emotions: ['í™”ë‚¨', 'ìŠ¬í””']
                },
                'friend-3': {
                    title: 'ì¹œêµ¬ê°€ ë¹„ë°€ì„ ë§í–ˆì–´ìš”',
                    A: 'ë‚´ ë¹„ë°€ì„ ë‹¤ë¥¸ ì¹œêµ¬ë“¤ì—ê²Œ ë§í–ˆì–´ìš”',
                    B: 'ì•„ë¬´ë„ ë‚  ì´í•´ ëª»í•´',
                    C: 'ë‹µë‹µí•˜ê³  ì†ìƒí–ˆì–´ìš”',
                    category: 'friend',
                    emotions: ['ë‹µë‹µí•¨', 'í™”ë‚¨']
                },
                'family-1': {
                    title: 'ë¶€ëª¨ë‹˜ì´ ì‹¸ìš°ì…¨ì–´ìš”',
                    A: 'ì–´ì ¯ë°¤ ë¶€ëª¨ë‹˜ì´ í¬ê²Œ ì‹¸ìš°ì…¨ì–´ìš”',
                    B: 'ë‚˜ ë•Œë¬¸ì— ì‹¸ìš°ì‹œëŠ” ê²ƒ ê°™ì•„',
                    C: 'ê±±ì •ë˜ê³  ë¶ˆì•ˆí–ˆì–´ìš”',
                    category: 'family',
                    emotions: ['ê±±ì •', 'ë‘ë ¤ì›€']
                },
                'family-2': {
                    title: 'ë™ìƒ ë•Œë¬¸ì— ì†ìƒí•´ìš”',
                    A: 'ë™ìƒì´ ë‚´ ë¬¼ê±´ì„ í•¨ë¶€ë¡œ ë§Œì ¸ì„œ ë§ê°€ëœ¨ë ¸ì–´ìš”',
                    B: 'ì—„ë§ˆëŠ” ë‚˜ë³´ë‹¤ ë™ìƒë§Œ ì˜ˆë»í•˜ì‹œëŠ” ê²ƒ ê°™ì•„',
                    C: 'í™”ê°€ ë‚˜ê³  ì„œëŸ¬ì› ì–´ìš”',
                    category: 'family',
                    emotions: ['í™”ë‚¨', 'ì„œê¸€í””']
                },
                'family-3': {
                    title: 'ë¶€ëª¨ë‹˜ì´ ë°”ì˜ì…”ì„œ ì™¸ë¡œì›Œìš”',
                    A: 'ë¶€ëª¨ë‹˜ì´ ë§ë²Œì´ë¼ ì§‘ì— í˜¼ì ìˆëŠ” ì‹œê°„ì´ ë§ì•„ìš”',
                    B: 'ë‚˜ë¥¼ ì‹ ê²½ ì•ˆ ì“°ì‹œëŠ” ê²ƒ ê°™ì•„',
                    C: 'ì™¸ë¡­ê³  ì“¸ì“¸í–ˆì–´ìš”',
                    category: 'family',
                    emotions: ['ì„œê¸€í””', 'ìŠ¬í””']
                },
                'emotion-1': {
                    title: 'ìì‹ ê°ì´ ì—†ì–´ìš”',
                    A: 'ì¹œêµ¬ë“¤ì€ ë‹¤ ì˜í•˜ëŠ”ë° ë‚˜ë§Œ ëª»í•˜ëŠ” ê²ƒ ê°™ì•„ìš”',
                    B: 'ë‚˜ëŠ” ì•ˆ ë  ê±°ì•¼',
                    C: 'ë‹µë‹µí•˜ê³  ì†ìƒí–ˆì–´ìš”',
                    category: 'emotion',
                    emotions: ['ë‹µë‹µí•¨', 'ì‹¤ë§']
                },
                'emotion-2': {
                    title: 'ê±±ì •ì´ ë§ì•„ìš”',
                    A: 'ìê¾¸ë§Œ ì•ˆ ì¢‹ì€ ì¼ì´ ìƒê¸¸ ê²ƒ ê°™ì•„ìš”',
                    B: 'ë‚˜ë§Œ í˜ë“  ê²ƒ ê°™ì•„',
                    C: 'ê±±ì •ë˜ê³  ë¶ˆì•ˆí–ˆì–´ìš”',
                    category: 'emotion',
                    emotions: ['ê±±ì •', 'ë‘ë ¤ì›€']
                },
                'emotion-3': {
                    title: 'í™”ê°€ ìì£¼ ë‚˜ìš”',
                    A: 'ì‘ì€ ì¼ì—ë„ ìê¾¸ í™”ê°€ ë‚˜ìš”',
                    B: 'ë‚˜ë¥¼ í™”ë‚˜ê²Œ í•˜ë ¤ê³  ì¼ë¶€ëŸ¬ ê·¸ëŸ¬ëŠ” ê²ƒ ê°™ì•„',
                    C: 'í™”ê°€ ë‚˜ê³  ì§œì¦ì´ ë‚¬ì–´ìš”',
                    category: 'emotion',
                    emotions: ['í™”ë‚¨', 'ë‹µë‹µí•¨']
                }
            },

            situationBasedChecklists: {
                school: {
                    thinking: [
                        "ì‹¤ìˆ˜ëŠ” ëˆ„êµ¬ë‚˜ í•  ìˆ˜ ìˆì–´. ë‹¤ìŒì—” ë” ì˜í•  ìˆ˜ ìˆì–´.",
                        "ì„ ìƒë‹˜ì€ ë‚˜ë¥¼ ë„ì™€ì£¼ì‹œë ¤ê³  í•˜ì‹œëŠ” ê±°ì•¼.",
                        "í•œ ë²ˆì˜ ì‹¤ìˆ˜ê°€ ì „ë¶€ë¥¼ ê²°ì •í•˜ëŠ” ê±´ ì•„ë‹ˆì•¼.",
                        "ì¹œêµ¬ë“¤ë„ ë‹¤ ì‹¤ìˆ˜ë¥¼ í•´. ë‚˜ë§Œ ê·¸ëŸ° ê²Œ ì•„ë‹ˆì•¼."
                    ],
                    help: [
                        "ì„ ìƒë‹˜ê»˜ ë„ì›€ì„ ìš”ì²­í•´ë³´ê¸°",
                        "ì¹œêµ¬ì™€ í•¨ê»˜ ê³µë¶€í•˜ê¸°",
                        "ì‘ì€ ëª©í‘œë¶€í„° ì°¨ê·¼ì°¨ê·¼ ì´ë£¨ê¸°",
                        "ë§¤ì¼ ì¡°ê¸ˆì”© ì—°ìŠµí•˜ê¸°"
                    ]
                },
                friend: {
                    thinking: [
                        "ì¹œêµ¬ë„ ë‚˜ì²˜ëŸ¼ ì‹¤ìˆ˜í•  ìˆ˜ ìˆì–´.",
                        "ë‚´ ìƒê°ì„ ì†”ì§í•˜ê²Œ ë§í•˜ë©´ ì´í•´í•´ì¤„ ê±°ì•¼.",
                        "ì§„ì§œ ì¹œêµ¬ë¼ë©´ í™”í•´í•  ìˆ˜ ìˆì–´.",
                        "ë‹¤ë¥¸ ì¹œêµ¬ë“¤ë„ ë‚˜ë¥¼ ì¢‹ì•„í•´ì¤„ ê±°ì•¼."
                    ],
                    help: [
                        "ì¹œêµ¬ì—ê²Œ ë‚´ ë§ˆìŒì„ ì†”ì§í•˜ê²Œ ë§í•˜ê¸°",
                        "í•¨ê»˜ ì¢‹ì•„í•˜ëŠ” í™œë™ ì°¾ì•„ë³´ê¸°",
                        "ì„œë¡œì˜ ì…ì¥ì—ì„œ ìƒê°í•´ë³´ê¸°",
                        "ë‹¤ë¥¸ ì¹œêµ¬ë“¤ê³¼ë„ ì‹œê°„ ë³´ë‚´ê¸°"
                    ]
                },
                family: {
                    thinking: [
                        "ë¶€ëª¨ë‹˜ì€ ë‚˜ë¥¼ ì‚¬ë‘í•˜ê³  ê³„ì…”.",
                        "ë™ìƒë„ ë‚˜ì²˜ëŸ¼ ì‚¬ë‘ë°›ì„ ê¶Œë¦¬ê°€ ìˆì–´.",
                        "ê°€ì¡±ì´ ì„œë¡œ ì´í•´í•˜ë ¤ê³  ë…¸ë ¥í•˜ë©´ ì¢‹ì•„ì§ˆ ê±°ì•¼.",
                        "ë‚˜ ë•Œë¬¸ì´ ì•„ë‹ˆë¼ ë‹¤ë¥¸ ì´ìœ ê°€ ìˆì„ ìˆ˜ ìˆì–´."
                    ],
                    help: [
                        "ë¶€ëª¨ë‹˜ê»˜ ë‚´ ë§ˆìŒì„ í¸ì§€ë¡œ ì „í•˜ê¸°",
                        "ê°€ì¡± íšŒì˜ ì‹œê°„ ë§Œë“¤ê¸°",
                        "ë™ìƒê³¼ í•¨ê»˜ í•  ìˆ˜ ìˆëŠ” ë†€ì´ ì°¾ê¸°",
                        "í•™êµ ìƒë‹´ ì„ ìƒë‹˜ê³¼ ì´ì•¼ê¸°í•˜ê¸°"
                    ]
                },
                emotion: {
                    thinking: [
                        "ë‚˜ëŠ” ì†Œì¤‘í•˜ê³  ê°€ì¹˜ ìˆëŠ” ì‚¬ëŒì´ì•¼.",
                        "ì§€ê¸ˆ ì´ ê°ì •ë„ ì§€ë‚˜ê°ˆ ê±°ì•¼.",
                        "ì™„ë²½í•  í•„ìš”ëŠ” ì—†ì–´. ë…¸ë ¥í•˜ëŠ” ê²Œ ì¤‘ìš”í•´.",
                        "ë‚´ê°€ ëŠë¼ëŠ” ê°ì •ì€ ìì—°ìŠ¤ëŸ¬ìš´ ê±°ì•¼."
                    ],
                    help: [
                        "ë‚´ê°€ ì˜í•˜ëŠ” ê²ƒ ëª©ë¡ ë§Œë“¤ê¸°",
                        "ê¸ì •ì ì¸ ë§ë¡œ ë‚˜ë¥¼ ê²©ë ¤í•˜ê¸°",
                        "ì¢‹ì•„í•˜ëŠ” í™œë™ìœ¼ë¡œ ê¸°ë¶„ ì „í™˜í•˜ê¸°",
                        "ì‹¬í˜¸í¡í•˜ë©° ë§ˆìŒ ê°€ë¼ì•‰íˆê¸°"
                    ]
                }
            },

            // ==================== INITIALIZATION ====================
            init() {
                this.loadFromStorage();
                this.setupEventListeners();
                this.startAutoSave();
            },

            setupEventListeners() {
                // Header inputs
                document.getElementById('counselor-name').addEventListener('input', () => this.saveToStorage());
                document.getElementById('client-name').addEventListener('input', () => this.saveToStorage());

                // Direct input mode
                document.getElementById('direct-a').addEventListener('input', () => this.saveToStorage());
                document.getElementById('direct-b').addEventListener('input', () => this.saveToStorage());
                document.getElementById('direct-c').addEventListener('input', () => this.saveToStorage());

                // Step 2
                document.getElementById('empathy-belief').addEventListener('change', (e) => {
                    if (e.target.value) document.getElementById('empathy-belief-custom').value = '';
                    this.updateEmpathyPreview();
                    this.saveToStorage();
                });
                document.getElementById('empathy-feeling').addEventListener('change', (e) => {
                    if (e.target.value) document.getElementById('empathy-feeling-custom').value = '';
                    this.updateEmpathyPreview();
                    this.saveToStorage();
                });
                document.getElementById('empathy-closing').addEventListener('change', (e) => {
                    if (e.target.value) document.getElementById('empathy-closing-custom').value = '';
                    this.updateEmpathyPreview();
                    this.saveToStorage();
                });
                document.getElementById('empathy-belief-custom').addEventListener('input', (e) => {
                    if (e.target.value) document.getElementById('empathy-belief').selectedIndex = 0;
                    this.updateEmpathyPreview();
                    this.saveToStorage();
                });
                document.getElementById('empathy-feeling-custom').addEventListener('input', (e) => {
                    if (e.target.value) document.getElementById('empathy-feeling').selectedIndex = 0;
                    this.updateEmpathyPreview();
                    this.saveToStorage();
                });
                document.getElementById('empathy-closing-custom').addEventListener('input', (e) => {
                    if (e.target.value) document.getElementById('empathy-closing').selectedIndex = 0;
                    this.updateEmpathyPreview();
                    this.saveToStorage();
                });
                document.getElementById('empathy-manual').addEventListener('input', () => this.saveToStorage());

                // Step 3
                document.getElementById('helpful-thinking').addEventListener('input', () => this.saveToStorage());
                document.getElementById('concrete-help').addEventListener('input', () => this.saveToStorage());

                // Step 4
                document.getElementById('personal-encouragement').addEventListener('input', () => this.saveToStorage());
                document.getElementById('two-week-promise').addEventListener('change', () => {
                    this.state.encouragement.twoWeekPromise = document.getElementById('two-week-promise').checked;
                    this.saveToStorage();
                });
            },

            // ==================== ONBOARDING ====================
            startApp() {
                document.getElementById('onboarding').classList.add('hidden');
                document.getElementById('app').classList.add('visible');
                setTimeout(() => {
                    this.goToWorrySection();
                }, 100);
            },

            // ==================== WORRY SECTION ====================
            switchWorryMode(mode) {
                this.state.worryMode = mode;

                // Toggle buttons
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.dataset.mode === mode) {
                        btn.classList.add('active');
                    }
                });

                // Toggle content
                document.querySelectorAll('.worry-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`worry-${mode}-mode`).classList.add('active');

                this.saveToStorage();
            },

            selectWorryCase() {
                const select = document.getElementById('worry-case-select');
                const caseId = select.value;

                if (!caseId) {
                    document.getElementById('selected-worry-display').classList.add('hidden');
                    this.state.selectedWorry = null;
                    return;
                }

                const worry = this.worryCases[caseId];
                this.state.selectedWorry = worry;

                // Display selected worry
                document.getElementById('display-a').textContent = worry.A;
                document.getElementById('display-b').textContent = worry.B;
                document.getElementById('display-c').textContent = worry.C;
                document.getElementById('selected-worry-display').classList.remove('hidden');

                // Auto-select emotions
                this.resetEmotions();
                worry.emotions.forEach(emotionName => {
                    const emotion = this.emotions.find(e => e.name === emotionName);
                    if (emotion) {
                        this.toggleEmotion(emotion.name, emotion.emoji, true);
                    }
                });

                this.saveToStorage();
                this.showNotification('ê³ ë¯¼ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            },

            applyDirectInput() {
                const a = document.getElementById('direct-a').value.trim();
                const b = document.getElementById('direct-b').value.trim();
                const c = document.getElementById('direct-c').value.trim();

                if (!a || !b || !c) {
                    this.showNotification('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                    return;
                }

                const category = this.classifyCategory(a, b, c);

                this.state.selectedWorry = {
                    title: 'ì§ì ‘ ì…ë ¥',
                    A: a,
                    B: b,
                    C: c,
                    category: category,
                    emotions: []
                };

                document.getElementById('display-a').textContent = a;
                document.getElementById('display-b').textContent = b;
                document.getElementById('display-c').textContent = c;
                document.getElementById('selected-worry-display').classList.remove('hidden');

                this.saveToStorage();
                this.showNotification('ê³ ë¯¼ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            },

            classifyCategory(a, b, c) {
                const text = (a + b + c).toLowerCase();

                if (text.includes('ë°œí‘œ') || text.includes('ì‹œí—˜') || text.includes('ì„±ì ') ||
                    text.includes('ì„ ìƒë‹˜') || text.includes('ìˆ™ì œ') || text.includes('í•™êµ')) {
                    return 'school';
                }

                if (text.includes('ì¹œêµ¬') || text.includes('ë†€ë¦¼') || text.includes('ì‹¸ì›€') || text.includes('ë¹„ë°€')) {
                    return 'friend';
                }

                if (text.includes('ë¶€ëª¨') || text.includes('ì—„ë§ˆ') || text.includes('ì•„ë¹ ') ||
                    text.includes('ë™ìƒ') || text.includes('ê°€ì¡±')) {
                    return 'family';
                }

                return 'emotion';
            },

            goToWorrySection() {
                this.state.currentStep = 0;
                document.querySelectorAll('.card').forEach(card => card.classList.add('hidden'));
                document.getElementById('worry-section').classList.remove('hidden');
                this.updateProgress();
            },

            // ==================== STEP NAVIGATION ====================
            goToStep(step) {
                if (step === 1 && !this.state.selectedWorry) {
                    this.showNotification('ë¨¼ì € ê³ ë¯¼ì„ ì„ íƒí•˜ê±°ë‚˜ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                    return;
                }

                this.state.currentStep = step;

                // Hide all cards
                document.querySelectorAll('.card').forEach(card => card.classList.add('hidden'));

                // Show target step
                if (step === 0) {
                    this.goToWorrySection();
                } else {
                    document.getElementById(`step-${step}`).classList.remove('hidden');
                    document.getElementById(`step-${step}`).classList.add('fade-enter');
                }

                // Update progress
                this.updateProgress();

                // Step-specific initialization
                if (step === 2) {
                    this.initStep2();
                } else if (step === 3) {
                    this.initStep3();
                }

                // Scroll to top
                window.scrollTo({top: 0, behavior: 'smooth'});
            },

            nextStep() {
                const currentStep = this.state.currentStep;

                // Validation
                if (currentStep === 1 && this.state.selectedEmotions.length === 0) {
                    this.showNotification('ê°ì •ì„ ìµœì†Œ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”', 'error');
                    return;
                }

                if (currentStep === 2) {
                    const empathy = document.getElementById('empathy-manual').value.trim() ||
                                   document.getElementById('empathy-preview').textContent.trim();
                    if (!empathy) {
                        this.showNotification('ê³µê° í‘œí˜„ì„ ì‘ì„±í•´ì£¼ì„¸ìš”', 'error');
                        return;
                    }
                }

                if (currentStep === 3) {
                    const thinking = document.getElementById('helpful-thinking').value.trim();
                    const help = document.getElementById('concrete-help').value.trim();
                    if (!thinking || !help) {
                        this.showNotification('ë„ì›€ ë°©ë²•ì„ ëª¨ë‘ ì‘ì„±í•´ì£¼ì„¸ìš”', 'error');
                        return;
                    }
                }

                this.goToStep(currentStep + 1);
            },

            prevStep() {
                const currentStep = this.state.currentStep;
                if (currentStep > 1) {
                    this.goToStep(currentStep - 1);
                }
            },

            updateProgress() {
                const step = this.state.currentStep;
                const progress = (step / 4) * 100;

                document.getElementById('progress-percent').textContent = Math.round(progress);
                document.getElementById('step-line-progress').style.width = progress + '%';

                // Update step items
                document.querySelectorAll('.step-item').forEach((item, index) => {
                    const stepNum = index + 1;
                    item.classList.remove('active', 'completed');

                    if (stepNum === step) {
                        item.classList.add('active');
                    } else if (stepNum < step) {
                        item.classList.add('completed');
                    }
                });
            },

            // ==================== STEP 1: EMOTIONS ====================
            toggleEmotion(name, emoji, silent = false) {
                const card = document.querySelector(`.emotion-card[data-emotion="${name}"]`);
                const index = this.state.selectedEmotions.findIndex(e => e.name === name);

                if (index > -1) {
                    this.state.selectedEmotions.splice(index, 1);
                    if (card) card.classList.remove('selected');
                } else {
                    this.state.selectedEmotions.push({name, emoji});
                    if (card) card.classList.add('selected');
                }

                this.updateSelectedEmotionsDisplay();
                this.saveToStorage();

                if (!silent) {
                    this.showNotification(`${emoji} ${name} ê°ì •ì´ ${index > -1 ? 'ì œê±°' : 'ì¶”ê°€'}ë˜ì—ˆìŠµë‹ˆë‹¤`, 'success');
                }
            },

            addCustomEmotion() {
                const input = document.getElementById('custom-emotion-input');
                const name = input.value.trim();

                if (!name) {
                    this.showNotification('ê°ì •ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                    return;
                }

                if (this.state.selectedEmotions.find(e => e.name === name)) {
                    this.showNotification('ì´ë¯¸ ì¶”ê°€ëœ ê°ì •ì…ë‹ˆë‹¤', 'error');
                    return;
                }

                this.state.selectedEmotions.push({name, emoji: 'ğŸ’­'});
                this.updateSelectedEmotionsDisplay();
                this.saveToStorage();

                input.value = '';
                this.showNotification(`${name} ê°ì •ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤`, 'success');
            },

            updateSelectedEmotionsDisplay() {
                const display = document.getElementById('selected-emotions-display');
                const list = document.getElementById('selected-emotions-list');

                if (this.state.selectedEmotions.length === 0) {
                    display.classList.add('hidden');
                    return;
                }

                display.classList.remove('hidden');
                list.innerHTML = this.state.selectedEmotions.map((emotion, index) => `
                    <div class="emotion-tag">
                        <span>${emotion.emoji} ${emotion.name}</span>
                        <button class="remove-emotion-btn" onclick="ABCHelper.removeEmotion(${index})">Ã—</button>
                    </div>
                `).join('');
            },

            removeEmotion(index) {
                const emotion = this.state.selectedEmotions[index];
                const card = document.querySelector(`.emotion-card[data-emotion="${emotion.name}"]`);
                if (card) card.classList.remove('selected');

                this.state.selectedEmotions.splice(index, 1);
                this.updateSelectedEmotionsDisplay();
                this.saveToStorage();
                this.showNotification('ê°ì •ì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            },

            resetEmotions() {
                this.state.selectedEmotions = [];
                document.querySelectorAll('.emotion-card').forEach(card => card.classList.remove('selected'));
                this.updateSelectedEmotionsDisplay();
                this.saveToStorage();
                this.showNotification('ê°ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            },

            // ==================== STEP 2: EMPATHY ====================
            initStep2() {
                // Set situation
                if (this.state.selectedWorry) {
                    document.getElementById('empathy-situation').textContent = this.state.selectedWorry.A;
                    this.state.empathy.situation = this.state.selectedWorry.A;
                }

                // Populate selects
                const beliefSelect = document.getElementById('empathy-belief');
                beliefSelect.innerHTML = '<option value="">-- ì„ íƒí•˜ì„¸ìš” --</option>' +
                    this.thoughts.map(t => `<option value="${t}">${t}</option>`).join('');

                const feelingSelect = document.getElementById('empathy-feeling');
                feelingSelect.innerHTML = '<option value="">-- ì„ íƒí•˜ì„¸ìš” --</option>' +
                    this.feelings.map(f => `<option value="${f}">${f}</option>`).join('');

                const closingSelect = document.getElementById('empathy-closing');
                closingSelect.innerHTML = '<option value="">-- ì„ íƒí•˜ì„¸ìš” --</option>' +
                    this.closings.map(c => `<option value="${c}">${c}</option>`).join('');

                // Restore saved values
                if (this.state.empathy.belief) {
                    beliefSelect.value = this.state.empathy.belief;
                }
                if (this.state.empathy.feeling) {
                    feelingSelect.value = this.state.empathy.feeling;
                }
                if (this.state.empathy.closing) {
                    closingSelect.value = this.state.empathy.closing;
                }
                if (this.state.empathy.manual) {
                    document.getElementById('empathy-manual').value = this.state.empathy.manual;
                }

                this.updateEmpathyPreview();
            },

            updateEmpathyPreview() {
                const beliefSelect = document.getElementById('empathy-belief').value;
                const beliefCustom = document.getElementById('empathy-belief-custom').value.trim();
                const feelingSelect = document.getElementById('empathy-feeling').value;
                const feelingCustom = document.getElementById('empathy-feeling-custom').value.trim();
                const closingSelect = document.getElementById('empathy-closing').value;
                const closingCustom = document.getElementById('empathy-closing-custom').value.trim();

                const belief = beliefCustom || beliefSelect;
                const feeling = feelingCustom || feelingSelect;
                const closing = closingCustom || closingSelect;

                this.state.empathy.belief = belief;
                this.state.empathy.feeling = feeling;
                this.state.empathy.closing = closing;

                let preview = '';
                if (this.state.empathy.situation) {
                    preview += `"${this.state.empathy.situation}"ë¼ê³  ìƒê°í–ˆêµ¬ë‚˜. `;
                }
                if (belief) {
                    preview += `"${belief}"ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆêµ¬ë‚˜. `;
                }
                if (feeling) {
                    preview += `ê·¸ë˜ì„œ ${feeling.replace('ìš”', '')}êµ¬ë‚˜. `;
                }
                if (closing) {
                    preview += closing;
                }

                document.getElementById('empathy-preview').textContent = preview || 'ìœ„ì—ì„œ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ì…ë ¥í•˜ë©´ ê³µê° í‘œí˜„ì´ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤.';
            },

            autoCompleteEmpathy() {
                const preview = document.getElementById('empathy-preview').textContent;
                if (preview && preview !== 'ìœ„ì—ì„œ ì„ íƒí•˜ë©´ ê³µê° í‘œí˜„ì´ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤.') {
                    document.getElementById('empathy-manual').value = preview;
                    this.state.empathy.manual = preview;
                    this.saveToStorage();
                    this.showNotification('ê³µê° í‘œí˜„ì´ ìë™ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                } else {
                    this.showNotification('ë¨¼ì € ìœ„ì˜ í•­ëª©ë“¤ì„ ì„ íƒí•´ì£¼ì„¸ìš”', 'error');
                }
            },

            resetEmpathy() {
                document.getElementById('empathy-belief').selectedIndex = 0;
                document.getElementById('empathy-feeling').selectedIndex = 0;
                document.getElementById('empathy-closing').selectedIndex = 0;
                document.getElementById('empathy-belief-custom').value = '';
                document.getElementById('empathy-feeling-custom').value = '';
                document.getElementById('empathy-closing-custom').value = '';
                document.getElementById('empathy-manual').value = '';

                this.state.empathy.belief = '';
                this.state.empathy.feeling = '';
                this.state.empathy.closing = '';
                this.state.empathy.manual = '';

                this.updateEmpathyPreview();
                this.saveToStorage();
                this.showNotification('ê³µê° í‘œí˜„ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            },

            // ==================== STEP 3: HELP ====================
            initStep3() {
                const category = this.state.selectedWorry?.category || 'emotion';
                const checklists = this.situationBasedChecklists[category];

                // Thinking checklist
                const thinkingContainer = document.getElementById('thinking-checklist');
                thinkingContainer.innerHTML = checklists.thinking.map((item, index) => `
                    <div class="checklist-item">
                        <input type="checkbox" id="thinking-${index}" value="${item}">
                        <label for="thinking-${index}">${item}</label>
                    </div>
                `).join('');

                // Help checklist
                const helpContainer = document.getElementById('help-checklist');
                helpContainer.innerHTML = checklists.help.map((item, index) => `
                    <div class="checklist-item">
                        <input type="checkbox" id="help-${index}" value="${item}">
                        <label for="help-${index}">${item}</label>
                    </div>
                `).join('');

                // Restore saved values
                if (this.state.help.thinking) {
                    document.getElementById('helpful-thinking').value = this.state.help.thinking;
                }
                if (this.state.help.concrete) {
                    document.getElementById('concrete-help').value = this.state.help.concrete;
                }
            },

            applyThinkingChecklist() {
                const checked = Array.from(document.querySelectorAll('#thinking-checklist input[type="checkbox"]:checked'));
                const values = checked.map(cb => cb.value);

                if (values.length === 0) {
                    this.showNotification('ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤', 'error');
                    return;
                }

                const textarea = document.getElementById('helpful-thinking');
                const current = textarea.value.trim();
                const newText = current ? current + '\n\n' + values.join('\n') : values.join('\n');

                textarea.value = newText;
                this.state.help.thinking = newText;
                this.saveToStorage();

                checked.forEach(cb => cb.checked = false);
                this.showNotification('ì„ íƒí•œ ë‚´ìš©ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            },

            applyHelpChecklist() {
                const checked = Array.from(document.querySelectorAll('#help-checklist input[type="checkbox"]:checked'));
                const values = checked.map(cb => cb.value);

                if (values.length === 0) {
                    this.showNotification('ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤', 'error');
                    return;
                }

                const textarea = document.getElementById('concrete-help');
                const current = textarea.value.trim();
                const newText = current ? current + '\n\n' + values.join('\n') : values.join('\n');

                textarea.value = newText;
                this.state.help.concrete = newText;
                this.saveToStorage();

                checked.forEach(cb => cb.checked = false);
                this.showNotification('ì„ íƒí•œ ë‚´ìš©ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            },

            showHelpModal() {
                document.getElementById('help-modal').classList.add('show');
            },

            closeModal() {
                document.getElementById('help-modal').classList.remove('show');
            },

            // ==================== STEP 4: ENCOURAGEMENT ====================
            drawRandomMessage() {
                const randomIndex = Math.floor(Math.random() * this.encouragementMessages.length);
                const message = this.encouragementMessages[randomIndex];

                document.getElementById('random-message-text').textContent = message;
                document.querySelector('.random-message-emoji').textContent = 'ğŸ‰';

                this.state.encouragement.randomMessage = message;
                this.saveToStorage();

                this.showNotification('ê²©ë ¤ ë©”ì‹œì§€ê°€ ë½‘í˜”ìŠµë‹ˆë‹¤!', 'success');
            },

            toggleFavorite() {
                const btn = document.getElementById('favorite-btn');
                this.state.encouragement.favorited = !this.state.encouragement.favorited;

                if (this.state.encouragement.favorited) {
                    btn.classList.add('favorited');
                    this.showNotification('ì¦ê²¨ì°¾ê¸°ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                } else {
                    btn.classList.remove('favorited');
                    this.showNotification('ì¦ê²¨ì°¾ê¸°ì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                }

                this.saveToStorage();
            },

            // ==================== RESULT ====================
            showResult() {
                // Gather data
                const counselorName = document.getElementById('counselor-name').value.trim() || 'ìƒë‹´ì';
                const clientName = document.getElementById('client-name').value.trim() || 'ì¹œêµ¬';

                const empathy = document.getElementById('empathy-manual').value.trim() ||
                               document.getElementById('empathy-preview').textContent.trim();

                const thinking = document.getElementById('helpful-thinking').value.trim();
                const help = document.getElementById('concrete-help').value.trim();
                const personal = document.getElementById('personal-encouragement').value.trim();
                const promise = document.getElementById('two-week-promise').checked;

                // Build result HTML
                let resultHTML = `
                    <div class="result-item step1">
                        <h3 class="result-item-title">
                            <span class="card-title-emoji">ğŸ’™</span>
                            Step 1: ë§ˆìŒ ê³µê°í•˜ê¸°
                        </h3>
                        <div class="result-item-content">
                            <p><strong>${clientName}</strong>ì´(ê°€) ëŠë‚€ ê°ì •:</p>
                            <p>${this.state.selectedEmotions.map(e => `${e.emoji} ${e.name}`).join(', ')}</p>
                        </div>
                    </div>

                    <div class="result-item step2">
                        <h3 class="result-item-title">
                            <span class="card-title-emoji">ğŸ’¬</span>
                            Step 2: ê³µê° í‘œí˜„í•˜ê¸°
                        </h3>
                        <div class="result-item-content">
                            <p>${empathy}</p>
                        </div>
                    </div>

                    <div class="result-item step3">
                        <h3 class="result-item-title">
                            <span class="card-title-emoji">ğŸ¤</span>
                            Step 3: ë„ì›€ ì°¾ê¸°
                        </h3>
                        <div class="result-item-content">
                            <p><strong>ë” ë„ì›€ì´ ë˜ëŠ” ìƒê°:</strong></p>
                            <p>${thinking}</p>
                            <br>
                            <p><strong>êµ¬ì²´ì ì¸ ë„ì›€ ë°©ë²•:</strong></p>
                            <p>${help}</p>
                        </div>
                    </div>

                    <div class="result-item step4">
                        <h3 class="result-item-title">
                            <span class="card-title-emoji">âœ¨</span>
                            Step 4: ê²©ë ¤í•˜ê¸°
                        </h3>
                        <div class="result-item-content">
                `;

                if (this.state.encouragement.randomMessage) {
                    resultHTML += `<p><strong>ê²©ë ¤ ë©”ì‹œì§€:</strong> ${this.state.encouragement.randomMessage}</p>`;
                }

                if (personal) {
                    resultHTML += `<p><strong>ë‚˜ë§Œì˜ ê²©ë ¤ ë©”ì‹œì§€:</strong><br>${personal}</p>`;
                }

                if (promise) {
                    resultHTML += `<p><strong>âœ“ 2ì£¼ í›„ì— ë‹¤ì‹œ ë§Œë‚˜ê¸°ë¡œ ì•½ì†í–ˆì–´ìš”</strong></p>`;
                }

                resultHTML += `
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 30px; padding: 20px; background: var(--color-accent-light); border-radius: var(--radius-md);">
                        <p style="font-size: 18px; font-weight: 500; color: var(--color-ink);">
                            ìƒë‹´ì: <strong>${counselorName}</strong> | ì¹œêµ¬: <strong>${clientName}</strong>
                        </p>
                        <p style="font-size: 14px; color: var(--color-ink-soft); margin-top: 10px;">
                            ì‘ì„±ì¼: ${new Date().toLocaleDateString('ko-KR')}
                        </p>
                    </div>
                `;

                document.getElementById('result-content').innerHTML = resultHTML;

                // Hide all cards and show result
                document.querySelectorAll('.card').forEach(card => card.classList.add('hidden'));
                document.getElementById('result-section').classList.remove('hidden');
                document.getElementById('result-section').classList.add('fade-enter');

                this.state.currentStep = 5;
                this.updateProgress();

                window.scrollTo({top: 0, behavior: 'smooth'});
            },

            downloadPNG() {
                const element = document.getElementById('result-content');

                html2canvas(element, {
                    scale: 2,
                    backgroundColor: '#FFFFFF',
                    logging: false
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `ABCìƒë‹´ê²°ê³¼_${new Date().toLocaleDateString('ko-KR').replace(/\./g, '-')}.png`;
                    link.href = canvas.toDataURL();
                    link.click();

                    this.showNotification('ì´ë¯¸ì§€ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                });
            },

            downloadPDF() {
                const element = document.getElementById('result-content');

                html2canvas(element, {
                    scale: 2,
                    backgroundColor: '#FFFFFF',
                    logging: false
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jspdf.jsPDF({
                        orientation: 'portrait',
                        unit: 'mm',
                        format: 'a4'
                    });

                    const imgWidth = 210;
                    const imgHeight = canvas.height * imgWidth / canvas.width;

                    pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
                    pdf.save(`ABCìƒë‹´ê²°ê³¼_${new Date().toLocaleDateString('ko-KR').replace(/\./g, '-')}.pdf`);

                    this.showNotification('PDFë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                });
            },

            newConsultation() {
                if (confirm('ìƒˆë¡œìš´ ìƒë‹´ì„ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ? í˜„ì¬ ë‚´ìš©ì€ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.')) {
                    this.resetAll();
                }
            },

            // ==================== RESET ====================
            resetAll() {
                if (!confirm('ì •ë§ë¡œ ì „ì²´ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

                // Clear state
                this.state = {
                    currentStep: 0,
                    worryMode: 'example',
                    selectedWorry: null,
                    selectedEmotions: [],
                    empathy: {
                        situation: '',
                        belief: '',
                        feeling: '',
                        closing: '',
                        manual: ''
                    },
                    help: {
                        thinking: '',
                        concrete: ''
                    },
                    encouragement: {
                        randomMessage: '',
                        personalMessage: '',
                        twoWeekPromise: false,
                        favorited: false
                    }
                };

                // Clear inputs
                document.getElementById('counselor-name').value = '';
                document.getElementById('client-name').value = '';
                document.getElementById('worry-case-select').selectedIndex = 0;
                document.getElementById('direct-a').value = '';
                document.getElementById('direct-b').value = '';
                document.getElementById('direct-c').value = '';
                document.getElementById('selected-worry-display').classList.add('hidden');

                this.resetEmotions();
                this.resetEmpathy();

                document.getElementById('helpful-thinking').value = '';
                document.getElementById('concrete-help').value = '';
                document.getElementById('personal-encouragement').value = '';
                document.getElementById('two-week-promise').checked = false;
                document.getElementById('favorite-btn').classList.remove('favorited');

                // Clear storage
                localStorage.removeItem('abcHelperState');

                // Go to start
                this.goToWorrySection();

                this.showNotification('ì „ì²´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            },

            // ==================== STORAGE ====================
            saveToStorage() {
                const data = {
                    state: this.state,
                    counselorName: document.getElementById('counselor-name').value,
                    clientName: document.getElementById('client-name').value,
                    directA: document.getElementById('direct-a').value,
                    directB: document.getElementById('direct-b').value,
                    directC: document.getElementById('direct-c').value,
                    empathyManual: document.getElementById('empathy-manual').value,
                    helpfulThinking: document.getElementById('helpful-thinking').value,
                    concreteHelp: document.getElementById('concrete-help').value,
                    personalEncouragement: document.getElementById('personal-encouragement').value,
                    timestamp: Date.now()
                };

                localStorage.setItem('abcHelperState', JSON.stringify(data));
            },

            loadFromStorage() {
                const saved = localStorage.getItem('abcHelperState');
                if (!saved) return;

                try {
                    const data = JSON.parse(saved);

                    // Check if data is less than 24 hours old
                    const age = Date.now() - data.timestamp;
                    if (age > 24 * 60 * 60 * 1000) {
                        localStorage.removeItem('abcHelperState');
                        return;
                    }

                    // Restore state
                    this.state = data.state;

                    // Restore inputs
                    document.getElementById('counselor-name').value = data.counselorName || '';
                    document.getElementById('client-name').value = data.clientName || '';
                    document.getElementById('direct-a').value = data.directA || '';
                    document.getElementById('direct-b').value = data.directB || '';
                    document.getElementById('direct-c').value = data.directC || '';
                    document.getElementById('empathy-manual').value = data.empathyManual || '';
                    document.getElementById('helpful-thinking').value = data.helpfulThinking || '';
                    document.getElementById('concrete-help').value = data.concreteHelp || '';
                    document.getElementById('personal-encouragement').value = data.personalEncouragement || '';

                    // Restore UI state
                    if (this.state.selectedWorry) {
                        document.getElementById('display-a').textContent = this.state.selectedWorry.A;
                        document.getElementById('display-b').textContent = this.state.selectedWorry.B;
                        document.getElementById('display-c').textContent = this.state.selectedWorry.C;
                        document.getElementById('selected-worry-display').classList.remove('hidden');
                    }

                    this.updateSelectedEmotionsDisplay();

                    if (this.state.encouragement.favorited) {
                        document.getElementById('favorite-btn').classList.add('favorited');
                    }

                    this.showNotification('ì´ì „ ì‘ì—… ë‚´ìš©ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤', 'success');
                } catch (e) {
                    console.error('Failed to load from storage:', e);
                    localStorage.removeItem('abcHelperState');
                }
            },

            startAutoSave() {
                setInterval(() => {
                    this.saveToStorage();
                }, 30000); // 30 seconds
            },

            // ==================== NOTIFICATIONS ====================
            showNotification(message, type = 'success') {
                const toast = document.getElementById('toast');
                const icon = document.getElementById('toast-icon');
                const messageEl = document.getElementById('toast-message');

                toast.className = `toast ${type}`;
                icon.textContent = type === 'success' ? 'âœ“' : '!';
                messageEl.textContent = message;

                toast.classList.add('show');

                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }
        };

        // ==================== INITIALIZE ON PAGE LOAD ====================
        document.addEventListener('DOMContentLoaded', () => {
            ABCHelper.init();
        });

        // Close modal when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                ABCHelper.closeModal();
            }
        });
    </script>
</body>
</html>
