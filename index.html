<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ABC 모델을 활용한 또래 상담 도우미. 친구의 고민을 4단계로 함께 풀어가요.">
    <title>ABC 친구 도우미 v2</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- ==================== ONBOARDING SCREEN ==================== -->
    <div id="onboarding" role="region" aria-label="시작 화면">
        <div class="onboarding-content">
            <div class="onboarding-emoji" aria-hidden="true">🤗</div>
            <h1 class="onboarding-title">ABC 친구 도우미</h1>
            <p class="onboarding-subtitle">친구의 고민을 함께 나누고<br>따뜻한 위로를 전해보세요</p>
            <button class="onboarding-btn" onclick="ABCHelper.startApp()" aria-label="상담 시작하기">시작하기</button>
        </div>
    </div>

    <!-- ==================== MAIN APP ==================== -->
    <div id="app" role="main">
        <div class="container">
            <!-- ==================== HEADER ==================== -->
            <header>
                <h1 class="header-title">ABC 친구 도우미 v2</h1>
                <div class="header-inputs">
                    <div class="input-group">
                        <label for="counselor-name">상담자 이름</label>
                        <input type="text" id="counselor-name" placeholder="내 이름을 입력하세요">
                    </div>
                    <div class="input-group">
                        <label for="client-name">상담받는 친구 이름</label>
                        <input type="text" id="client-name" placeholder="친구 이름을 입력하세요">
                    </div>
                </div>
                <div class="text-center">
                    <button class="reset-all-btn" onclick="ABCHelper.resetAll()">전체 초기화</button>
                </div>
            </header>

            <!-- ==================== PROGRESS STEPPER ==================== -->
            <div class="progress-stepper" role="navigation" aria-label="상담 진행 단계">
                <div class="progress-percent">
                    <span id="progress-percent">0</span>%
                </div>
                <div class="steps-container" role="list" aria-label="단계 목록">
                    <div class="step-line">
                        <div class="step-line-progress" id="step-line-progress"></div>
                    </div>
                    <div class="step-item" data-step="1" role="listitem" onclick="ABCHelper.goToStep(1)">
                        <div class="step-circle" role="button" tabindex="0" aria-label="1단계: 마음 공감하기">💙</div>
                        <div class="step-label">마음 공감하기</div>
                    </div>
                    <div class="step-item" data-step="2" role="listitem" onclick="ABCHelper.goToStep(2)">
                        <div class="step-circle" role="button" tabindex="0" aria-label="2단계: 공감 표현하기">💬</div>
                        <div class="step-label">공감 표현하기</div>
                    </div>
                    <div class="step-item" data-step="3" role="listitem" onclick="ABCHelper.goToStep(3)">
                        <div class="step-circle" role="button" tabindex="0" aria-label="3단계: 도움 찾기">🤝</div>
                        <div class="step-label">도움 찾기</div>
                    </div>
                    <div class="step-item" data-step="4" role="listitem" onclick="ABCHelper.goToStep(4)">
                        <div class="step-circle" role="button" tabindex="0" aria-label="4단계: 격려하기">✨</div>
                        <div class="step-label">격려하기</div>
                    </div>
                </div>
            </div>

            <!-- ==================== WORRY INPUT SECTION ==================== -->
            <div class="card" id="worry-section">
                <h2 class="card-title">
                    <span class="card-title-emoji">📝</span>
                    친구의 고민
                </h2>

                <div class="worry-mode-toggle" role="tablist" aria-label="고민 입력 방식">
                    <button class="mode-btn active" data-mode="example" role="tab" aria-selected="true" aria-pressed="true" onclick="ABCHelper.switchWorryMode('example')">
                        고민 사례 선택
                    </button>
                    <button class="mode-btn" data-mode="direct" role="tab" aria-selected="false" aria-pressed="false" onclick="ABCHelper.switchWorryMode('direct')">
                        직접 입력하기
                    </button>
                </div>

                <div class="worry-content active" id="worry-example-mode">
                    <div class="worry-select-container">
                        <select id="worry-case-select" onchange="ABCHelper.selectWorryCase()">
                            <option value="">-- 고민 사례를 선택하세요 --</option>
                            <optgroup label="학교생활">
                                <option value="school-1">발표가 두려워요</option>
                                <option value="school-2">성적이 떨어졌어요</option>
                                <option value="school-3">선생님께 혼났어요</option>
                            </optgroup>
                            <optgroup label="친구관계">
                                <option value="friend-1">친구가 놀려요</option>
                                <option value="friend-2">친구와 싸웠어요</option>
                                <option value="friend-3">친구가 비밀을 말했어요</option>
                            </optgroup>
                            <optgroup label="가족관계">
                                <option value="family-1">부모님이 싸우셨어요</option>
                                <option value="family-2">동생 때문에 속상해요</option>
                                <option value="family-3">부모님이 바쁘셔서 외로워요</option>
                            </optgroup>
                            <optgroup label="감정과자신감">
                                <option value="emotion-1">자신감이 없어요</option>
                                <option value="emotion-2">걱정이 많아요</option>
                                <option value="emotion-3">화가 자주 나요</option>
                            </optgroup>
                        </select>
                    </div>
                </div>

                <div class="worry-content" id="worry-direct-mode">
                    <div class="abc-grid">
                        <div class="abc-item">
                            <label>A (사실): 무슨 일이 있었나요?</label>
                            <textarea id="direct-a" placeholder="예: 친구가 나를 놀렸어요"></textarea>
                        </div>
                        <div class="abc-item">
                            <label>B (생각): 어떤 생각이 들었나요?</label>
                            <textarea id="direct-b" placeholder="예: 나를 싫어하나봐"></textarea>
                        </div>
                        <div class="abc-item">
                            <label>C (결과): 어떤 기분이나 행동이 나타났나요?</label>
                            <textarea id="direct-c" placeholder="예: 슬프고 화가 났어요"></textarea>
                        </div>
                    </div>
                    <div class="text-center mt-20">
                        <button class="auto-complete-btn" onclick="ABCHelper.applyDirectInput()">적용하기</button>
                    </div>
                </div>

                <div class="selected-worry-display hidden" id="selected-worry-display">
                    <h4>선택된 고민</h4>
                    <div class="worry-abc-item">
                        <strong>A (사실):</strong> <span id="display-a"></span>
                    </div>
                    <div class="worry-abc-item">
                        <strong>B (생각):</strong> <span id="display-b"></span>
                    </div>
                    <div class="worry-abc-item">
                        <strong>C (결과):</strong> <span id="display-c"></span>
                    </div>
                    <div style="text-align: center; margin-top: 24px;">
                        <button class="next-btn" onclick="ABCHelper.goToStep(1)" style="font-size: 1.1rem; padding: 14px 40px;">1단계로 시작하기 →</button>
                    </div>
                </div>
            </div>

            <!-- ==================== STEP 1: 마음 공감하기 ==================== -->
            <div class="card hidden" id="step-1">
                <h2 class="card-title">
                    <span class="card-title-emoji">💙</span>
                    Step 1: 마음 공감하기
                </h2>

                <p style="margin-bottom: 20px; color: var(--color-ink-soft);">
                    친구가 느낀 감정을 모두 선택해주세요.
                </p>

                <div class="emotion-grid">
                    <div class="emotion-card" data-emotion="슬픔" onclick="ABCHelper.toggleEmotion('슬픔', '😢')">
                        <div class="emotion-emoji">😢</div>
                        <div class="emotion-label">슬픔</div>
                    </div>
                    <div class="emotion-card" data-emotion="화남" onclick="ABCHelper.toggleEmotion('화남', '😠')">
                        <div class="emotion-emoji">😠</div>
                        <div class="emotion-label">화남</div>
                    </div>
                    <div class="emotion-card" data-emotion="걱정" onclick="ABCHelper.toggleEmotion('걱정', '😟')">
                        <div class="emotion-emoji">😟</div>
                        <div class="emotion-label">걱정</div>
                    </div>
                    <div class="emotion-card" data-emotion="실망" onclick="ABCHelper.toggleEmotion('실망', '😞')">
                        <div class="emotion-emoji">😞</div>
                        <div class="emotion-label">실망</div>
                    </div>
                    <div class="emotion-card" data-emotion="두려움" onclick="ABCHelper.toggleEmotion('두려움', '😨')">
                        <div class="emotion-emoji">😨</div>
                        <div class="emotion-label">두려움</div>
                    </div>
                    <div class="emotion-card" data-emotion="부끄러움" onclick="ABCHelper.toggleEmotion('부끄러움', '😳')">
                        <div class="emotion-emoji">😳</div>
                        <div class="emotion-label">부끄러움</div>
                    </div>
                    <div class="emotion-card" data-emotion="서글픔" onclick="ABCHelper.toggleEmotion('서글픔', '😔')">
                        <div class="emotion-emoji">😔</div>
                        <div class="emotion-label">서글픔</div>
                    </div>
                    <div class="emotion-card" data-emotion="답답함" onclick="ABCHelper.toggleEmotion('답답함', '😤')">
                        <div class="emotion-emoji">😤</div>
                        <div class="emotion-label">답답함</div>
                    </div>
                </div>

                <div class="custom-emotion-input">
                    <input type="text" id="custom-emotion-input" placeholder="다른 감정을 추가하세요">
                    <button class="add-emotion-btn" onclick="ABCHelper.addCustomEmotion()">추가</button>
                </div>

                <div class="selected-emotions-display hidden" id="selected-emotions-display">
                    <h4>선택된 감정</h4>
                    <div class="emotion-tags" id="selected-emotions-list"></div>
                </div>

                <div class="text-center mt-20">
                    <button class="reset-emotions-btn" onclick="ABCHelper.resetEmotions()">감정 초기화</button>
                </div>

                <div class="nav-buttons">
                    <button class="nav-btn prev-btn" onclick="ABCHelper.goToWorrySection()">이전</button>
                    <button class="nav-btn next-btn" onclick="ABCHelper.nextStep()" id="step1-next">다음</button>
                </div>
            </div>

            <!-- ==================== STEP 2: 공감 표현하기 ==================== -->
            <div class="card hidden" id="step-2">
                <h2 class="card-title">
                    <span class="card-title-emoji">💬</span>
                    Step 2: 공감 표현하기
                </h2>

                <div class="empathy-form-group">
                    <label>현재 상황 (A - 사실)</label>
                    <p id="empathy-situation" style="padding: 12px; background: var(--color-s2-bg); border-radius: var(--radius-sm); margin-bottom: 15px;"></p>
                </div>

                <div class="empathy-form-group">
                    <label>B (생각)</label>
                    <select id="empathy-belief">
                        <option value="">-- 예시에서 선택하세요 --</option>
                    </select>
                    <textarea id="empathy-belief-custom" class="custom-input" placeholder="또는 직접 입력해 보세요 (예: 나만 혼자인 것 같아)" rows="2"></textarea>
                </div>

                <div class="empathy-form-group">
                    <label>C (느낌/결과)</label>
                    <select id="empathy-feeling">
                        <option value="">-- 예시에서 선택하세요 --</option>
                    </select>
                    <textarea id="empathy-feeling-custom" class="custom-input" placeholder="또는 직접 입력해 보세요 (예: 속상하고 외로웠어)" rows="2"></textarea>
                </div>

                <div class="empathy-form-group">
                    <label>마무리 말</label>
                    <select id="empathy-closing">
                        <option value="">-- 예시에서 선택하세요 --</option>
                    </select>
                    <textarea id="empathy-closing-custom" class="custom-input" placeholder="또는 직접 입력해 보세요 (예: 내가 옆에 있어 줄게)" rows="2"></textarea>
                </div>

                <div class="empathy-preview">
                    <h4>공감 표현 미리보기</h4>
                    <div class="empathy-preview-text" id="empathy-preview"></div>
                </div>

                <div class="empathy-form-group">
                    <label>공감 표현 수정하기</label>
                    <textarea id="empathy-manual" placeholder="위의 공감 표현을 직접 수정할 수 있습니다"></textarea>
                </div>

                <div class="btn-group">
                    <button class="auto-complete-btn" onclick="ABCHelper.autoCompleteEmpathy()">추천 공감 표현 자동 생성하기</button>
                    <button class="reset-btn" onclick="ABCHelper.resetEmpathy()">공감 표현 초기화</button>
                </div>

                <div class="nav-buttons">
                    <button class="nav-btn prev-btn" onclick="ABCHelper.prevStep()">이전</button>
                    <button class="nav-btn next-btn" onclick="ABCHelper.nextStep()" id="step2-next">다음</button>
                </div>
            </div>

            <!-- ==================== STEP 3: 도움 찾기 ==================== -->
            <div class="card hidden" id="step-3">
                <h2 class="card-title">
                    <span class="card-title-emoji">🤝</span>
                    Step 3: 도움 찾기
                </h2>

                <div class="help-section">
                    <h4>1. 더 도움이 되는 생각 만들기</h4>
                    <div class="checklist" id="thinking-checklist"></div>
                    <button class="apply-btn" onclick="ABCHelper.applyThinkingChecklist()">선택한 내용 적용하기</button>
                    <textarea class="help-textarea" id="helpful-thinking" placeholder="도움이 되는 생각을 작성하세요"></textarea>
                </div>

                <div class="help-section">
                    <h4>2. 구체적인 도움 방법</h4>
                    <div class="checklist" id="help-checklist"></div>
                    <button class="apply-btn" onclick="ABCHelper.applyHelpChecklist()">선택한 내용 적용하기</button>
                    <textarea class="help-textarea" id="concrete-help" placeholder="구체적인 도움 방법을 작성하세요"></textarea>
                </div>

                <div class="text-center">
                    <button class="help-solutions-btn" onclick="ABCHelper.showHelpModal()">도움 방법 모음집 보기</button>
                </div>

                <div class="nav-buttons">
                    <button class="nav-btn prev-btn" onclick="ABCHelper.prevStep()">이전</button>
                    <button class="nav-btn next-btn" onclick="ABCHelper.nextStep()" id="step3-next">다음</button>
                </div>
            </div>

            <!-- ==================== STEP 4: 격려하기 ==================== -->
            <div class="card hidden" id="step-4">
                <h2 class="card-title">
                    <span class="card-title-emoji">✨</span>
                    Step 4: 격려하기
                </h2>

                <div class="encouragement-section">
                    <h4>랜덤 격려 메시지</h4>
                    <div class="random-message-display" id="random-message-display">
                        <button class="favorite-btn" id="favorite-btn" onclick="ABCHelper.toggleFavorite()">⭐</button>
                        <div class="random-message-text" id="random-message-text">아래 버튼을 눌러 격려 메시지를 뽑아보세요!</div>
                        <div class="random-message-emoji">🎁</div>
                    </div>
                    <button class="draw-message-btn" onclick="ABCHelper.drawRandomMessage()">랜덤 메시지 뽑기</button>
                </div>

                <div class="personal-encouragement-group">
                    <label>나만의 격려 메시지</label>
                    <textarea id="personal-encouragement" placeholder="친구에게 전하고 싶은 따뜻한 말을 작성하세요"></textarea>
                </div>

                <div class="promise-checkbox">
                    <input type="checkbox" id="two-week-promise">
                    <label for="two-week-promise">2주 후에 다시 만나 이야기하기로 약속했어요</label>
                </div>

                <div class="nav-buttons">
                    <button class="nav-btn prev-btn" onclick="ABCHelper.prevStep()">이전</button>
                    <button class="nav-btn next-btn" onclick="ABCHelper.showResult()">상담 완료하기</button>
                </div>
            </div>

            <!-- ==================== RESULT SECTION ==================== -->
            <div class="card hidden" id="result-section">
                <div class="result-section">
                    <div class="result-header">
                        <h2 class="result-title">🎉 상담 결과</h2>
                        <p class="result-subtitle">따뜻한 마음으로 완성한 친구 상담입니다</p>
                    </div>

                    <div id="result-content"></div>

                    <div class="result-actions">
                        <button class="download-png-btn" onclick="ABCHelper.downloadPNG()">이미지로 저장 (PNG)</button>
                        <button class="download-pdf-btn" onclick="ABCHelper.downloadPDF()">PDF로 저장</button>
                        <button class="print-btn" onclick="window.print()">인쇄하기</button>
                        <button class="new-consultation-btn" onclick="ABCHelper.newConsultation()">새 상담 시작하기</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== HELP MODAL ==================== -->
    <div class="modal" id="help-modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="help-modal-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="help-modal-title">도움 방법 모음집</h2>
                <button class="close-modal" onclick="ABCHelper.closeModal()" aria-label="모달 닫기">&times;</button>
            </div>
            <div class="modal-body">
                <h3>학교생활 도움 방법</h3>
                <ul>
                    <li>선생님께 도움 요청하기</li>
                    <li>방과후 친구들과 함께 공부하기</li>
                    <li>작은 목표부터 차근차근 달성하기</li>
                    <li>발표 연습을 미리 해보기</li>
                </ul>

                <h3>친구관계 도움 방법</h3>
                <ul>
                    <li>친구에게 솔직하게 내 마음 전달하기</li>
                    <li>함께 좋아하는 활동 찾아보기</li>
                    <li>서로의 입장에서 생각해보기</li>
                    <li>신뢰할 수 있는 어른에게 도움 요청하기</li>
                </ul>

                <h3>가족관계 도움 방법</h3>
                <ul>
                    <li>부모님께 내 마음 편지로 전하기</li>
                    <li>가족과 함께하는 시간 만들기</li>
                    <li>동생과 함께 할 수 있는 놀이 찾기</li>
                    <li>학교 상담 선생님과 이야기하기</li>
                </ul>

                <h3>감정과 자신감 도움 방법</h3>
                <ul>
                    <li>내가 잘하는 것 목록 만들어보기</li>
                    <li>긍정적인 말로 나를 격려하기</li>
                    <li>걱정 일기 쓰기</li>
                    <li>심호흡하며 마음 가라앉히기</li>
                    <li>좋아하는 활동으로 기분 전환하기</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- ==================== NOTIFICATION TOAST ==================== -->
    <div class="toast" id="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <span class="toast-icon" id="toast-icon" aria-hidden="true"></span>
        <span class="toast-message" id="toast-message"></span>
    </div>

    <!-- ==================== SCRIPTS ==================== -->
    <script src="js/data.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/export.js"></script>
    <script src="js/silent-spell-helper.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
